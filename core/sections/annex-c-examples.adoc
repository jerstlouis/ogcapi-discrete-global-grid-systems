[appendix,obligation="informative"]
:appendix-caption: Annex
[[annex_examples]]
== Examples
This annex provides a set of examples illustrating requests and responses for retrieving DGGS <<rc_data-retrieval,zone data>> and performing <<rc_zone-query,zone queries>> using capabilities defined by this DGGS API.

=== Collection description
DGGS resources can be attached to an https://docs.ogc.org/DRAFTS/20-024.html[_OGC API - Common - Part 2_] collection origin resource path.
The following global GEBCO 2014 bathymetry collection will be used as an example:

https://maps.gnosis.earth/ogcapi/collections/gebco?f=json[\https://maps.gnosis.earth/ogcapi/collections/gebco]

An example JSON response for this collection description resource, as defined by Common - Part 2 and the <<rc_collection-dggs, Collection DGGS Requirements Class>>, is presented below, including a link to the list of available DGGRSs:

[%unnumbered%]
[source,json]
----
{
   "id" : "gebco",
   "title" : "GEBCO 2014",
   "description" : "General Bathymetric Chart of the Oceans (2014)",
   "attribution" : "General Bathymetric Chart of the Oceans (<a href='https://www.gebco.net/news_and_media/gebco_2014_grid.html'>GEBCO_2014</a>)",
   "extent" : {
      "spatial" : {
         "bbox" : [ [ -180, -90, 180, 90 ] ],
         "grid" : [
            { "firstCoordinate": -180, "relativeBounds": [ 0, 0 ], "cellsCount" : 65537, "resolution" : 0.0054931640625 },
            { "firstCoordinate":  -90, "relativeBounds": [ 0, 0 ], "cellsCount" : 32769, "resolution" : 0.0054931640625 }
         ]
   } },
   "minScaleDenominator" : 2183915.0938621787354,
   "minCellSize" : 0.0054931640625,
   "links" : [
      { "rel" : "self", "title" : "Information about this GEBCO data collection",
        "href" : "/ogcapi/collections/gebco"
      },
      { "rel" : "[ogc-rel:schema]",  "title" : "Schema",
         "href" : "/ogcapi/collections/gebco/schema"
      },
      { "rel" : "[ogc-rel:queryables]",  "title" : "Queryables",
         "href" : "/ogcapi/collections/gebco/queryables"
      },
      { "rel" : "[ogc-rel:dggrs-list]", "title" : "Available DGGRSs for this GEBCO data collection",
        "href" : "/ogcapi/collections/gebco/dggs"
      }
   ]
}
----

=== Listing available DGGRSs
Whether accessing DGGS resources for the root of the API (which may correspond to a dataset, as stated in https://docs.ogc.org/is/17-069r3/17-069r3.html#_scope[OGC API - Features]) or for a particular collection,
the first DGGS-specific request made by a client would be to list the available DGGRSs.
Following the link obtained from the previous example response, a client can determine which DGGRSs are supported by the API at that endpoint:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs?f=json[\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs]

An example JSON response for this DGGRS list, as defined by the <<rc_core,Core requirements class>>, is presented below:

[%unnumbered%]
[source,json]
----
{
   "links" : [
      { "rel" : "[ogc-rel:geodata]", "href" : "/ogcapi/collections/gebco" }
   ],
   "dggrs" : [
      {
         "id" : "GNOSISGlobalGrid",
         "title" : "GNOSIS Global Grid",
         "uri" : "[ogc-dggrs:GNOSISGlobalGrid]",
         "links" : [
            { "rel" : "self", "title" : "GNOSISGlobalGrid DGGRS for GEBCO",
              "href" : "/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid" },
            { "rel" : "[ogc-rel:dggrs-definition]", "title" : "GNOSISGlobalGrid DGGRS definition",
              "href" : "/ogcapi/dggrs/GNOSISGlobalGrid"
            }
         ]
      },
      {
         "id" : "ISEA9R",
         "title" : "ISEA Aperture 9 Rhombic",
         "uri" : "[ogc-dggrs:ISEA9R]",
         "links" : [
            { "rel" : "self", "title" : "ISEA9R DGGRS for GEBCO",
              "href" : "/ogcapi/collections/gebco/dggs/ISEA9R"
            },
            { "rel" : "[ogc-rel:dggrs-definition]", "title" : "ISEA9R DGGRS definition",
              "href" : "/ogcapi/dggrs/ISEA9R"
            }
         ]
      },
      {
         "id" : "ISEA3H",
         "title" : "ISEA Aperture 3 Hexagonal",
         "uri" : "[ogc-dggrs:ISEA3H]"
         "links" : [
            { "rel" : "self", "title" : "ISEA3H DGGRS for GEBCO",
              "href" : "/ogcapi/collections/gebco/dggs/ISEA3H"
            },
            { "rel" : "[ogc-rel:dggrs-definition]", "title" : "ISEA3H DGGRS definition",
              "href" : "/ogcapi/dggrs/ISEA3H"
            }
         ]
      }
   ]
}
----

=== Retrieving the description of a specific DGGRS
A client would then select a particular DGGRS of which it already has built-in knowledge, possibly using a software library implementing support for one or more DGGRS available from the server.

In this example, the client selects the <<isea3h-dggrs,ISEA3H DGGRS>> (because it has built-in support for it) and follows the link to obtain a complete description of the DGGRS:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H?f=json[\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H]

An example JSON response for this DGGRS description, as defined by the <<rc_core,Core requirements class>>, is presented below.
Note how the description is more comprehensive than the summary description included for each item in the previous DGGRS list response, including a description,
a default (relative) depth as well as additional links and link templates.

[[isea3h-dggs-description-response]]
[%unnumbered%]
[source,json]
----
{
   "id" : "ISEA3H",
   "title" : "ISEA Aperture 3 Hexagonal",
   "description" : "A Discrete Global Grid Reference System based on the Icosahedral Snyder Equal Area projection, with aperture 3 hexagonal zones, using an indexing scheme based on ISEA9R.",
   "uri" : "[ogc-dggrs:ISEA3H]",
   "defaultDepth": 10,
   "maxRefinementLevel": 18,
   "maxRelativeDepth": 13,
   "links" : [
      { "rel" : "self", "title" : "ISEA3H DGGRS for GEBCO",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H"
      },
      { "rel" : "[ogc-rel:dggrs-definition]", "title" : "ISEA3H DGGRS definition",
        "href" : "/ogcapi/dggrs/ISEA3H"
      },
      { "rel" : "[ogc-rel:dggrs-zone-query]", "title" : "ISEA3H DGGRS Zone Query",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones"
      },
      { "rel" : "[ogc-rel:geodata]", "href" : "/ogcapi/collections/gebco" }
   ],
   "linkTemplates" : [
      {
         "rel" : "[ogc-rel:dggrs-zone-info]",
         "title" : "DGGRS zone information for a particular ISEA3H zone",
         "uriTemplate" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/{zoneId}"
      },
      {
         "rel" : "[ogc-rel:dggrs-zone-data]",
         "title" : "Data retrieval for a particular ISEA3H zone",
         "uriTemplate" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/{zoneId}/data"
      }
   ]
}
----

ISEA3H is an equal area discrete global grid hierarchy based on the Icosahedral Snyder Equal Area projection, using hexagonal grids with a refinement ratio (aperture) of 3.
All hexagonal zones of a given refinement level have exactly the same area, while each of the twelve (12) pentagonal zones occupies 5/6th the area of a hexagonal zone of the same level.

See the informative <<annex-dggrs-def,annex B>> for examples of DGGRS definition responses which the client could obtain by following the `[ogc-rel:dggrs-definition]` links.
The annex includes provisionary definitions for the <<isea3h-dggrs,ISEA3H>>, <<isea9r-dggrs,ISEA9R>> and <<ggg-dggrs,GNOSIS Global Grid>> used in these examples
which will likely be used to initially populate an authoritative registry, Additional DGGRS entries would be submitted, reviewed and registered based on the needs of the community.

=== Retrieving information for a specific DGGRS zone

Later examples will demonstrate how to list available zones by performing zone queries, but for now these examples will skip directly to <<zone-info,retrieving information about a particular zone>>.
This capability is also defined in the Core requirements class and exists primarily for completeness of the API resource tree, making the `../dggs/zones/{zoneId}` resource between
`../dggs/zones` and `../dggs/zones/{zoneId}/data` also retrievable.
The zone information is useful for enabling exploration of datasets using a browser interface, as well as for educational, demonstration and debugging purposes.
An actual DGGS API client for visualization or performing analytics would normally not access this resource at all, since URL templates allow to directly access the data for a particular zone.
While the Core requirements class makes several recommendations about statistical information and topological relationships that should be included in the zone information resource,
clients may not rely on any of this information being present. Clients can instead rely on their own local software libraries to establish topological relationships, can use zone queries
to pose questions that can be answered by a list of zone IDs, or can retrieve zone data packets containing values from multiple sub-zones to perform their own analytics.
A future extension could also introduce mandatory requirements making some of the recommended content such as summary statistics or additional useful information mandatory, which clients could then rely on
for conforming implementations.

This example assumes a client does for some reason request information in a JSON representation about a particular ISEA3H DGGRS zone, say `E6-317-A`, based on its built-in support for that DGGRS.
Perhaps this client is an Executable Test Suite -- a set of code providing runtime tests for the assertions defined by the Abstract Test Suite. Implementing this resource is still required
to conform to the Core conformance class, including at minimum an `id` and links to the DGGRS and data retrieval, if applicable.
The GET request URL and response for this zone information resource associated with the GEBCO collection would then look like the following:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-317-A?f=json[\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-317-A]

[%unnumbered%]
[source,json]
----
{
   "id" : "E6-317-A",
   "links" : [
      { "rel" : "[ogc-rel:geodata]", "href" : "/ogcapi/collections/gebco" },
      { "rel" : "[ogc-rel:dggrs]", "title" : "ISEA3H DGGRS for GEBCO",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H"
      },
      { "rel" : "[ogc-rel:dggrs-definition]", "title" : "ISEA3H DGGRS definition",
        "href" : "/ogcapi/dggrs/ISEA3H"
      },
      { "rel" : "[ogc-rel:dggrs-zone-data]", "title" : "ISEA3H Zone E6-317-A data for GEBCO",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-317-A/data"
      },

      { "rel" : "[ogc-rel:dggrs-zone-parent]", "title": "Parent zone D6-65-E",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/D6-65-E" },
      { "rel" : "[ogc-rel:dggrs-zone-parent]", "title": "Parent zone D6-4A-F",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/D6-4A-F" },
      { "rel" : "[ogc-rel:dggrs-zone-parent]", "title": "Parent zone D6-66-D (centroid child)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/D6-66-D" },

      { "rel" : "[ogc-rel:dggrs-zone-child]", "title": "Child zone E6-317-D (centroid child)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-317-D" },
      { "rel" : "[ogc-rel:dggrs-zone-child]", "title": "Child zone E6-317-E (vertex child)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-317-E" },
      { "rel" : "[ogc-rel:dggrs-zone-child]", "title": "Child zone E6-317-F (vertex child)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-317-F" },
      { "rel" : "[ogc-rel:dggrs-zone-child]", "title": "Child zone E6-316-E (vertex child)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-316-E" },
      { "rel" : "[ogc-rel:dggrs-zone-child]", "title": "Child zone E6-2C5-F (vertex child)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-2C5-F" },
      { "rel" : "[ogc-rel:dggrs-zone-child]", "title": "Child zone E6-2C5-E (vertex child)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-2C5-E" },
      { "rel" : "[ogc-rel:dggrs-zone-child]", "title": "Child zone E6-2C6-F (vertex child)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-2C6-F" },

      { "rel" : "[ogc-rel:dggrs-zone-neighbor]", "title": "Neighboring zone E6-2C5-A (left)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-2C5-A" },
      { "rel" : "[ogc-rel:dggrs-zone-neighbor]", "title": "Neighboring zone E6-369-A (right)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-369-A" },
      { "rel" : "[ogc-rel:dggrs-zone-neighbor]", "title": "Neighboring zone E6-2C6-A (top-left)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-2C6-A" },
      { "rel" : "[ogc-rel:dggrs-zone-neighbor]", "title": "Neighboring zone E6-318-A (top-right)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-318-A" },
      { "rel" : "[ogc-rel:dggrs-zone-neighbor]", "title": "Neighboring zone E6-316-A (bottom-left)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-316-A" },
      { "rel" : "[ogc-rel:dggrs-zone-neighbor]", "title": "Neighboring zone E6-368-A (bottom-right)",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/E6-368-A" }
   ],
   "shapeType" : "hexagon",
   "areaMetersSquare" : 7774205482.76313,
   "level": 8,
   "crs": "[OGC:CRS84]",
   "centroid": [ 34.7801691523003, 45.4293774177864 ],
   "bbox": [ 34.0622890215095, 44.966579546195, 35.5048602543667, 45.8904784696083 ],
   "statistics" : {
      "Elevation" : {
         "minimum": -56.415161132812,
         "maximum": 499.67742919922,
         "average": 34.243211554643,
         "stdDev": 58.802922870029
      }
   },
   "geometry" : {
      "type" : "Polygon",
      "coordinates" : [
         [ [ 34.9825792437548, 45.8904784696083 ], [ 34.8364790349283, 45.8553425997858 ],
           [ 34.7198070743586, 45.8270885080255 ], [ 34.6033186032223, 45.798706447509  ],
           [ 34.4870121932418, 45.7701975609193 ], [ 34.3708864462471, 45.7415629623275 ],
           [ 34.2549399933378, 45.7128037381496 ], [ 34.2158619560033, 45.6203085346353 ],
           [ 34.1847997584098, 45.5462655152704 ], [ 34.1539133527403, 45.4721817939786 ],
           [ 34.1232007406641, 45.3980582297526 ], [ 34.0926599474139, 45.3238956664313 ],
           [ 34.0622890215095, 45.2496949329617 ], [ 34.1882009344326, 45.181974647101  ],
           [ 34.2824290413424, 45.131089867063  ], [ 34.3660396924306, 45.085791129104  ],
           [ 34.4495117238456, 45.040428739687  ], [ 34.5848590190371, 44.966579546195  ],
           [ 34.6988274980307, 44.9951957400744 ], [ 34.8129599968164, 45.023694616047  ],
           [ 34.9272577135866, 45.0520752443535 ], [ 35.0417218725293, 45.0803366718494 ],
           [ 35.156353724587,  45.1084779211899 ], [ 35.2998813084759, 45.1434839527948 ],
           [ 35.3321842414696, 45.2173283845563 ], [ 35.364672186874,  45.2911278096443 ],
           [ 35.3973472857246, 45.3648812441139 ], [ 35.4302117049963, 45.4385876857853 ],
           [ 35.4632676379116, 45.5122461139102 ], [ 35.5048602543667, 45.6042500443317 ],
           [ 35.4216718871623, 45.6502103665179 ], [ 35.307054399127,  45.7133043112688 ],
           [ 35.2235259331723, 45.7591167641879 ], [ 35.0665221514834, 45.8448463562633 ],
           [ 34.9825792437548, 45.8904784696083 ] ]
      ]
   }
}
----

An HTML representation of that zone information resource, allowing a user to browse through parent, children and neighboring zones,
could look like the following:

[#img_zone_info_html='{figure-caption} {counter:figure-num}']
.Sample HTML response of an ISEA3H DGGRS zone information resource for GEBCO data
image::images/zone-info-html.png[width=700,align="center"]

=== Simple zone queries
Having selected a particular DGGRS, one use case for the API is for a client to perform spatial queries by <<rc_zone-query,requesting a list of zones>>.
The simplest case is to simply request a list of all available zones for a discrete global grid of a given refinement level (`zone-level`), which in the case of a particular collection implies zones
for which the collection has data.

==== Querying a particular refinement level

If no `zone-level` query parameter is provided, the server is free to pick a default zone level for such queries. This would result in a reasonable number of zones returned,
based on the area and resolution of the data collection. In this example, the client will explicitly request a list of zones at refinement level 1.

By default, if `compact-zones=false` is not specified by the client, zone queries are compacted. This means that
if all sub-zones of a parent zone would be included in the response, they get replaced by that parent zone so that fewer zones need to be enumerated.
This can result in zones being returned of a lower refinement level than the requested `zone-level`, and therefore a mix of zones of different levels.
A full globe response would therefore always result in the list of all zones of refinement level 0.
In these examples, the client will explicitly set `compact-zones=false`.

Following the `[ogc-rel:dggrs-zone-query]` link, specifying these query parameters, and negotiating a JSON response response using an `Accept: application/json` header, the client requests from the endpoint:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?f=json&zone-level=1&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?zone-level=1&compact-zones=false]

An example JSON response for this Zone Query JSON, as defined by the <<rc_zone-query,Zone Query requirements class>>, is presented below:

[%unnumbered%]
[source,json]
----
{
   "zones" : [
      "A0-0-D", "A0-0-E", "A0-0-F", "A0-0-G", "A1-0-D", "A1-0-E",
      "A1-0-F", "A2-0-D", "A2-0-E", "A2-0-F", "A3-0-D", "A3-0-E",
      "A3-0-F", "A4-0-D", "A4-0-E", "A4-0-F", "A5-0-D", "A5-0-E",
      "A5-0-F", "A6-0-D", "A6-0-E", "A6-0-F", "A7-0-D", "A7-0-E",
      "A7-0-F", "A8-0-D", "A8-0-E", "A8-0-F", "A9-0-D", "A9-0-E",
      "A9-0-F", "A9-0-H"
   ],
   "returnedAreaMetersSquare" : 510065621724088.5,
   "links" : [
      { "rel" : "[ogc-rel:dggrs]", "title" : "ISEA3H DGGS for GEBCO",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H"
      },
      { "rel" : "[ogc-rel:dggrs-definition]", "title" : "ISEA3H DGGRS definition",
         "href" : "/ogcapi/dggrs/ISEA3H"
      },
      { "rel" : "[ogc-rel:geodata]", "href" : "/ogcapi/collections/gebco" }
   ],
   "linkTemplates" : [
      { "rel" : "[ogc-rel:dggrs-zone-data]", "title" : "ISEA3H data for GEBCO",
        "uriTemplate" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/{zoneId}/data",
      }
   ]
}
----

The server returned all 32 zones of ISEA3H level 1 (which corresponds to a truncated icosahedron -- the traditional soccer ball pattern), because the collection has global coverage.

A visualization of the response from negotiating `application/geo+json` for the above request is seen below.

[#img_zones_globe='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 1 visualized in QGIS
image::images/zones-globe-isea3h-level1.png[width=700,align="center"]

==== Querying for a spatio-temporal subset

To request a list of zones for an area of interest, the `bbox` or `subset` query parameter can be used.
For temporal datasets, the `datetime` can be used as well as `subset=time(...)` to constrain the query to a time of interest.
For restricting the same zone query to a bounding box area from (40°N, 30°E) to (60°N,50°E), the client could make either of the following requests:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?f=json&bbox=30,40,50,60&zone-level=1&compact-zones=false["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?bbox=30,40,50,60&zone-level=1&compact-zones=false"]

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?f=json&subset=Lat(40:60),Lon(30:50)&zone-level=1&compact-zones=false["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?subset=Lat(40:60),Lon(30:50)&zone-level=1&compact-zones=false"]

and obtain the following response (negotiating a JSON zone list again):

[%unnumbered%]
[source,json]
----
{
   "zones" : [ "A0-0-G", "A6-0-E" ],
   "returnedAreaMetersSquare" : 31170676883138.8,
   "links" : [
      { "rel" : "[ogc-rel:dggrs]", "title" : "ISEA3H DGGS for GEBCO",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H"
      },
      { "rel" : "[ogc-rel:dggrs-definition]", "title" : "ISEA3H DGGRS definition",
         "href" : "/ogcapi/dggrs/ISEA3H"
      },
      { "rel" : "[ogc-rel:geodata]", "href" : "/ogcapi/collections/gebco" }
   ],
   "linkTemplates" : [
      { "rel" : "[ogc-rel:dggrs-zone-data]", "title" : "ISEA3H data for GEBCO",
        "uriTemplate" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/{zoneId}/data",
      }
   ]
}
----

This time, the server returned only two zones of ISEA3H level 1.

A visualization of the response from negotiating `application/geo+json` for the above request, together with the bounding box used, is seen below.

[#img_zones_globe='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 1 for a (40°N, 30°E) to (60°N,50°E) bounding box visualized in QGIS
image::images/zones-globe-isea3h-level1-bbox.png[width=300,align="center"]

As seen below, an HTML representation could include rendered previews of the data for the zone area, summary information, as well as links to retrieve the data and access the zone information resource for each zone.
Note that the significant variance in area (-11.31% and +6.66% from the reference mean zone (whose area is calculated by dividing the Earth surface area by the total number of zones) is due to the fact that `A0-0-G` is a pentagon (in the ISEA projection -- on the Earth surface it looks more like a decagon) which occupies 5/6th the
area of hexagons such as `A6-0-E` (which on the Earth surface is one of the hexagons appearing as a nonagon), as well as the fact that at level 1, the number of pentagons (12) is significant compared to the total number of zones (32).

[#img_zones_html='{figure-caption} {counter:figure-num}']
.Sample HTML response for a zone query for ISEA3H DGGRS at level 1 for a (40°N, 30°E) to (60°N,50°E) bounding box
image::images/zones-bbox-html.png[width=700,align="center"]

Of course with a higher zone level, many more zones can be returned:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?f=json&bbox=30,40,50,60&zone-level=8&compact-zones=false["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?bbox=30,40,50,60&zone-level=8&compact-zones=false"]

[#img_zones_bbox_isea3h='{figure-caption} {counter:figure-num}']
.Sample HTML response for a zone query for ISEA3H DGGRS at level 8 for a (40°N, 30°E) to (60°N,50°E) bounding box
image::images/zones-bbox-isea3h.png[width=500,align="center"]

==== Zones representing data availability

The primary purpose of the <<rc_zone-query,Zone Query requirements class>> is to ask questions of the type _"Where is it?"_.
The answer is a region of spacetime represented by a list of zones. This region might correspond to where data is available for a particular collection of data, whether that data is static or the result
of a processing workflow. Later examples will demonstrate more complex queries using CQL2 expressions.
These resulting spatiotemporal regions could otherwise have been communicated as a multi-polygon vector mask or as a rasterized 1-bit image or opacity channel.

The following example illustrates the case of a collection (elevation data from https://viewfinderpanoramas.org/[Viewfinder Panoramas]) which does not have data for everywhere on the globe (only over land), using a higher zone level of 6 for the query.

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=6&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=6&compact-zones=false]

[#img_zones_srtm_l6='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 6 for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/zones-srtm-isea3h-level6.png[width=700,align="center"]

Using a bounding box to restrict the query to an area of interest, a higher zone level of 10 could be used:

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=10&bbox=30,40,50,50&compact-zones=false["\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=10&bbox=30,40,50,50&compact-zones=false"]

[#img_zones_srtm_l10_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 10, using a (40°N, 30°E) to (40°N,50°E) bounding box, for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/zones-srtm-isea3h-level10-bbox.png[width=500,align="center"]

An implementation of the DGGS API works independently of the nature of the data, whether dealing with gridded coverage or vector features. This allows easily performing complex analytics involving heterogeneous data sources.
The previous examples all used gridded coverage data sources. The following example illustrates the same capabilities using the Natural Earth states and provinces collection:

https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:cultural:ne_10m_admin_1_states_provinces/dggs/ISEA3H/zones?f=json&zone-level=6&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:cultural:ne_10m_admin_1_states_provinces/dggs/ISEA3H/zones?zone-level=6&compact-zones=false]

[#img_zones_nestates='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 6, for a https://naturalearthdata.com/[Natural Earth] states and provinces collection, visualized in QGIS
image::images/zones-states-isea3h.png[width=700,align="center"]

The similarity between the response for this collection of states and provinces features compared to the same request earlier for a gridded elevation coverages showcases the potential for DGGS zone queries to facilitate data integration.

==== Querying sub-zones of a parent zone

The Zone Query requirements class defines the `parent-zone` query parameter as one more way to restrict the query spatially (and temporally in the case of a temporal DGGRS), which is particularly useful for hierarchical exploration.
For example, to restrict the query to sub-zones of `A6-0-E` rather than using a bounding box, the client could perform the following request (at level 8):

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=8&parent-zone=A6-0-E&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=8&parent-zone=A6-0-E&compact-zones=false]

[#img_zones_srtm_l8_parent_zone='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 8, for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones/A6-0-E[A6-0-E], for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/zones-srtm-isea3h-level8-parent-zone.png[width=500,align="center"]

The client could then pick one of the returned zones, say `E6-317-A`, for deeper exploration at level 16:

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=16&parent-zone=E6-317-A&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=16&parent-zone=E6-317-A&compact-zones=false]

[#img_zones_srtm_l16_parent_zone='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 16, for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones/E6-317-A[E6-317-A], for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/zones-srtm-isea3h-level16-parent-zone.png[width=500,align="center"]

Going back to A6-0-E (a level 1 zone), this could also be used to retrieve the immediate children by requesting the next level (2), to step down the hierarchy a single refinement level at a time:

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=2&parent-zone=A6-0-E&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=2&parent-zone=A6-0-E&compact-zones=false]

Since they all contain data, the seven children zones (one centroid child and six vertex children) are returned.

[#img_zones_srtm_l10_parent_zone='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 2, for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones/A6-0-E[A6-0-E] (outline shown), for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/zones-srtm-isea3h-next-level.png[width=400,align="center"]


==== ISEA9R (rhombus) Zone Queries

Although the examples so far have used the ISEA3H DGGRS, the DGGS API Standard is completely agnostic of the DGGRS.
Future planned parts for OGC Abstract Topic 21 will standardize new categories of DGGH, including volumetric (Part 2), temporal (Part 3) and axis-aligned (Part 4).
The DGGS API Standard, as demonstrated in this examples section, is ready to handle any DGGRS, including DGGRSs based on these new DGGH types.

The following examples demonstrates equivalent zone queries using the <<isea9r-dggrs,ISEA9R DGGS>>, a dual DGGS of ISEA3H even refinement levels, which can be considered axis-aligned in a CRS derived from rotating and shearing the ISEA planar projection.
In the ISEA planar projection, the ISEA9R zones are shaped as rhombuses.

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?f=json&zone-level=3&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?zone-level=3&compact-zones=false]

[#img_zones_isea9r_l3='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA9R DGGRS at level 3 for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection visualized in QGIS
image::images/zones-srtm-isea9r-level3.png[width=700,align="center"]

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones?f=json&bbox=30,40,50,60&zone-level=4&compact-zones=false["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones?bbox=30,40,50,60&zone-level=4&compact-zones=false"]

[#img_zones_isea9r_l4_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA9R DGGRS at level 4 for a (40°N, 30°E) to (60°N,50°E) bounding box visualized in QGIS
image::images/ISEA9R-bboxL4.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?f=json&zone-level=4&parent-zone=B6-2&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?zone-level=4&parent-zone=B6-2&compact-zones=false]

[#img_zones_isea9r_l4_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA9R DGGRS at level 4 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones/B6-2[B6-2], for https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/zones-srtm-isea9r-level4-parent-zone.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?f=json&zone-level=8&parent-zone=E6-317&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?zone-level=8&parent-zone=E6-317&compact-zones=false]

[#img_zones_isea9r_l8_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA9R DGGRS at level 8 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones/E6-317[E6-317], for https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/zones-srtm-isea9r-level8-parent-zone.png[width=500,align="center"]

Although ISEA9R is axis-aligned, it is also perfectly equal area.

==== GNOSIS Global Grid (WGS84 rectangles) Zone Queries

The next zone query examples use the <<ggg-dggrs,GNOSIS Global Grid DGGRS>>. The GNOSIS Global Grid is also axis-aligned, with the axes being the geographic latitude and longitude.
On a plate carée projection, the zones are shaped as rectangles, which conveniently correspond to typical EPSG:4326 / CRS84 bounding boxes.

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?f=json&zone-level=5&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=5&compact-zones=false]

[#img_zones_ggg_l5='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for GNOSIS Global Grid DGGRS at level 5 for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection visualized in QGIS
image::images/zones-srtm-ggg-level5.png[width=700,align="center"]

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones?f=json&bbox=30,40,50,60&zone-level=7&compact-zones=false["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones?bbox=30,40,50,60&zone-level=7&compact-zones=false"]

[#img_zones_ggg_l7_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for GNOSIS Global Grid DGGRS at level 7 for a (40°N, 30°E) to (60°N,50°E) bounding box visualized in QGIS
image::images/ggg-bboxL7.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?f=json&zone-level=8&parent-zone=2-2-9&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?zone-level=8&parent-zone=2-2-9&compact-zones=false]

[#img_zones_ggg_l8_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for GNOSIS Global Grid DGGRS at level 8 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones/2-2-9[2-2-9], for https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/zones-srtm-ggg-level8-parent-zone.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?f=json&zone-level=13&parent-zone=6-1F-98&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?zone-level=13&parent-zone=6-1F-98&compact-zones=false]

[#img_zones_ggg_l13_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for GNOSIS Global Grid DGGRS at level 13 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones/6-1F-98[6-1F-98], for https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/zones-srtm-ggg-level13-parent-zone.png[width=500,align="center"]

=== Compact zone queries
The following examples are reprises of some of the earlier examples leaving compact zones enabled.
These examples showcase how the zone compacting mechanism allows to communicate the same spatial area using fewer zones.

==== ISEA3H compact zone queries
Compacting ISEA3H zones is complicated by sub-zones not being fully congruent.
The approach demonstrated here skips a refinement level, taking advantage of the fact that seven of the grandchildren of a zone are congruent. Overlaps are seen, as six holes
are left at the vertices of the grandparent, each occupying 1/3rd the size of a congruent grandchild. Note how 7 + 6 x 1/3 = 9 (3 x 3), which corresponds to the two subsequent refinements at the refinement ratio of 3.
If the neighboring grandparent of the same refinement level cannot be used, then the non-congruent vertex children must be included, resulting in these overlaps.

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?f=json&bbox=30,40,50,60&zone-level=8["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?bbox=30,40,50,60&zone-level=8"]

[#img_compact_bbox_isea3h='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response querying ISEA3H DGGRS at level 8 for a (40°N, 30°E) to (60°N,50°E) bounding box
image::images/isea3h-compact-bbox.png[width=700,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=6[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=6]

[#img_compact_isea3h_l6='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS at level 6 for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/isea3h-compact-srtm.png[width=700,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=10&bbox=30,40,50,50["\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=10&bbox=30,40,50,50"]

[#img_compact_isea3h_l10_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS at level 10, using a (40°N, 30°E) to (40°N,50°E) bounding box, for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/compact-srtm-isea3h-level10-bbox.png[width=600,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=16&parent-zone=E6-317-A[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=16&parent-zone=E6-317-A]

[#img_compact_srtm_l16_parent_zone='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS at level 16, for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones/E6-317-A[E6-317-A], for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/compact-srtm-isea3h-level16-parent-zone.png[width=600,align="center"]

==== ISEA9R compact zone queries
Compacting ISEA9R zones can be achieved quite simply given that all sub-zones are fully congruent.

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?f=json&zone-level=3[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?zone-level=3]

[#img_compact_isea9r_l3='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA9R DGGRS at level 3 for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection visualized in QGIS
image::images/compact-srtm-isea9r-level3.png[width=700,align="center"]

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones?f=json&bbox=30,40,50,60&zone-level=4["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones?bbox=30,40,50,60&zone-level=4"]

[#img_compact_isea9r_l4_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA9R DGGRS at level 4 for a (40°N, 30°E) to (60°N,50°E) bounding box visualized in QGIS
image::images/compact-isea9r-bboxL4.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?f=json&zone-level=4&parent-zone=B6-2[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?zone-level=4&parent-zone=B6-2]

[#img_compact_isea9r_l4_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA9R DGGRS at level 4 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones/B6-2[B6-2], for https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/compact-srtm-isea9r-level4-parent-zone.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?f=json&zone-level=8&parent-zone=E6-317[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?zone-level=8&parent-zone=E6-317]

[#img_compact_isea9r_l8_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA9R DGGRS at level 8 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones/E6-317[E6-317], for https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/compact-srtm-isea9r-level8-parent-zone.png[width=600,align="center"]

==== GNOSIS Global Grid compact zone queries
Compacting GNOSIS Global Grid zones is also simple to achieve since sub-zones are also fully congruent.

To illustrate how the width of the zones attempts to remain equal to the height, the following examples are visualized using the world Mercator projection.
As with the previous examples for ISEA3H and ISEA9R, the zones of a given refinement level are filled with the same color.
Note that the zones closer to the poles are wider in longitude than zones closer to the equator, and can be seen in a 2-to-1 configuration at jumps in the https://docs.ogc.org/is/17-083r4/17-083r4.html#variable-matrixwidth-tile-matrix[variable widths] coalescence factor such as at the 45° parallel,
but these zones still occupy a similar area within the error budget.
However, in these illustrations, the polar zones appear much larger than zones of the same level closer to the equator because the Mercator projection enlarges features away from the equator.

<<<
https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?f=json&zone-level=5[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=5]

[#img_zones_ggg_l5='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying GNOSIS Global Grid DGGRS at level 5 for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection visualized in QGIS
image::images/compact-srtm-ggg-level5.png[width=700,align="center"]

<<<

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones?f=json&bbox=30,40,50,60&zone-level=7["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones?bbox=30,40,50,60&zone-level=7"]

[#img_zones_ggg_l7_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying GNOSIS Global Grid DGGRS at level 7 for a (40°N, 30°E) to (60°N,50°E) bounding box visualized in QGIS
image::images/compact-ggg-bboxL7.png[width=300,align="center"]

<<<

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?f=json&zone-level=8&parent-zone=2-2-9[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?zone-level=8&parent-zone=2-2-9]

[#img_zones_ggg_l8_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying GNOSIS Global Grid DGGRS at level 8 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones/2-2-9[2-2-9], for https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/compact-srtm-ggg-level8-parent-zone.png[width=500,align="center"]

<<<

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?f=json&zone-level=13&parent-zone=6-1F-98[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?zone-level=13&parent-zone=6-1F-98]

[#img_zones_ggg_l13_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying GNOSIS Global Grid DGGRS at level 13 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones/6-1F-98[6-1F-98], for https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/compact-srtm-ggg-level13-parent-zone.png[width=700,align="center"]

=== Filtering zone queries using CQL2 expressions
The Zone Query capabilities are most useful for use cases where the retrieved zone list is the result of some operation,
whether a processing workflow or the evaluation of a query expressed by the client.
The <<rc_zone-query-cql2-filter,CQL2 filter>> capability supports expressing such queries using the https://docs.ogc.org/DRAFTS/21-065r1.html[OGC Common Query Language (CQL2)].
Note that the processing workflow could also itself include CQL2 expressions using https://docs.ogc.org/DRAFTS/21-009.html#section_fields_modifiers[input/output field modifiers].

The CQL2 requirements class in the OGC API - DGGS Standard specifically calls for the https://docs.ogc.org/DRAFTS/21-065r1.html#cql2-text[CQL2-Text encoding], which is an intuitive representation with many similarities to SQL.
CQL2 defines minimum capabilities (https://docs.ogc.org/DRAFTS/21-065r1.html#cql2-core[Basic CQL2]) as well as additional optional capabilities, such as
https://docs.ogc.org/DRAFTS/21-065r1.html#arithmetic[arithmetic operations] and https://docs.ogc.org/DRAFTS/21-065r1.html#spatial-functions[spatial relation functions].
A DGGS API implementation's conformance resource (`/conformance` as defined in https://docs.ogc.org/is/19-072/19-072.html[OGC API - Common - Part 1: Core] "Landing Page" requirements class) enables the client
to know which capabilities are supported.

Basic CQL2 includes support for logical operators as well as to compare the value of queryables against literals using relational operators.
The following examples will use the same GEBCO collection as earlier examples to illustrate these capabilities.
The previous simple zone queries using this collection were not particularly interesting since the collection covers the entire globe,
but the use of CQL2 will enable the use of its data values.
First, the client would retrieve the queryables by following the `[ogc-rel:queryables]` link from the collection description:

https://maps.gnosis.earth/ogcapi/collections/gebco/queryables?f=json[https://maps.gnosis.earth/ogcapi/collections/gebco/queryables]

The `application/schema+json` response would look like so:

[%unnumbered%]
[source,json]
----
{
   "$schema" : "https://json-schema.org/draft/2020-12/schema",
   "$id" : "https://maps.gnosis.earth/ogcapi/collections/gebco/queryables",
   "title" : "General Bathymetric Chart of the Oceans",
   "type" : "object",
   "properties" : {
      "Elevation" :
      {
         "type" : "number",
         "x-ogc-propertySeq" : 1,
         "x-ogc-definition": "https://qudt.org/vocab/quantitykind/Altitude",
         "x-ogc-unit": "m"
      },
      "rec.geom" : {
         "x-ogc-role" : "primary-geometry",
         "format" : "geometry-point"
      }
   }
}
----

This informs the client that an `Elevation` queryable is available for use in CQL2 expressions.
Although this collection is a gridded coverage, a `rec.geom` queryable is still included in the schema which represents the geometry of each individual grid cell.
Since the value associated with these cells represent a point in this collection, the format indicates `geometry-point`. Later examples will make use of this `rec.geom` property.

The client could then submit the following zone query to return only zones where elevation is below sea level (`Elevation < 0`), at refinement level 6:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/isea3h/zones?filter=Elevation<0&zone-level=6&f=json["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/isea3h/zones?filter=Elevation < 0&zone-level=6"]

The following image is a visualization of the list of zones returned.

[#img_cql2_gebco_Elevation='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS for https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] with CQL2 expression `Elevation < 0` visualized in QGIS
image::images/cql2-gebco-elevation.png[width=700,align="center"]

The client could also request deeper elevations e.g., `Elevation < -4000`:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/isea3h/zones?filter=Elevation%20<%20-4000&zone-level=6&f=json["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/isea3h/zones?filter=Elevation < -4000&zone-level=6"]

[#img_cql2_gebco_Elevation_4000='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS for https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] with CQL2 expression `Elevation < -4000` visualized in QGIS
image::images/cql2-gebco-elevation4000.png[width=700,align="center"]

or for high elevations e.g., `Elevation > 3000`:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/isea3h/zones?filter=Elevation>3000&zone-level=6&f=json["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/isea3h/zones?filter=Elevation > 3000&zone-level=6"]

[#img_cql2_gebco_Elevation_high='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS for https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] with CQL2 expression `Elevation > 3000` visualized in QGIS
image::images/cql2-gebco-elevation-high.png[width=700,align="center"]

or for either deep or high elevations e.g., `Elevation < -4000 or Elevation > 3000`:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/isea3h/zones?filter=Elevation<%20-%204000%20or%20Elevation>3000&zone-level=6&f=json["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/isea3h/zones?filter=Elevation < -4000 or Elevation > 3000&zone-level=6"]

[#img_cql2_gebco_Elevation_high_or_deep='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS for https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] with CQL2 expression `Elevation < -4000 or Elevation > 3000` visualized in QGIS
image::images/cql2-gebco-elevation-high-or-deep.png[width=700,align="center"]

This last visualization highlights the fact that the Andes and Antarctica mountains are actually very close to a very deep sea.

If the implementation supports spatial relation functions, a query could test intersection with a geometry.
In CQL2-Text, spatial geometries are expressed using Well-Known Text (WKT) literals.
The following example returns zones intersecting the Bermuda Triangle, making use of the `rec.geom` queryable, which represents the geometry of the individual coverage grid cells, mentioned earlier, at refinement level 9.

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/isea3h/zones?zone-level=9&filter=S_INTERSECTS(rec.geom,POLYGON((-64.8%2032.3,-65.5%2018.3,-80.3%2025.2,-64.8%2032.3)))&f=json["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/isea3h/zones?zone-level=9&filter=S_INTERSECTS(rec.geom,POLYGON((-64.8 32.3,-65.5 18.3,-80.3 25.2,-64.8 32.3)))"]

[#img_cql2_gebco_polygon='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS for https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] with a CQL2 expression using S_INTERSECTS() for a WKT triangular polygon visualized in QGIS
image::images/cql2-polygon-l9.png[width=600,align="center"]

This spatial filter could also be combined with a relational operator as in the following query for `Elevation < -5500` within the Bermuda Triangle:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/isea3h/zones?zone-level=11&filter=Elevation%20<%20-5500%20and%20S_INTERSECTS(rec.geom,POLYGON((-64.8%2032.3,-65.5%2018.3,-80.3%2025.2,-64.8%2032.3)))&f=json["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/isea3h/zones?zone-level=11&filter=Elevation < -5500 and S_INTERSECTS(rec.geom,POLYGON((-64.8 32.3,-65.5 18.3,-80.3 25.2,-64.8 32.3)))"]

[#img_cql2_gebco_Elevation_polygon='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS for https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] with a CQL2 expression using both `Elevation < -5500` as well as S_INTERSECTS() for a WKT polygon visualized in QGIS
image::images/cql2-5500-depth-bermuda-l11.png[width=500,align="center"]

To illustrate the use of CQL2 arithmetic operators, the following example uses a collection of daily climate CMIP5 data from the https://cds.climate.copernicus.eu/cdsapp#!/dataset/projections-cmip5-daily-single-levels[Copernicus Climate Data Store].
The request is for zones where the difference between two different fields of the coverage, the maximum (`tasmax`) and minimum (`tasmin`) daily near-surface air temperature, is greater than 10 degrees Kelvin.
In addition, this request uses the `datetime` query parameter to subset the temporal dimension for June 1, 2023.

https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/isea3h/zones?zone-level=7&filter=(tasmax-tasmin)%3E10&datetime=2023-06-01&f=json["\https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/isea3h/zones?zone-level=7&filter=(tasmax-tasmin)>10&datetime=2023-06-01"]

[#img_cql2_tas_delta='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS for CMIP5 daily surface temperature from https://cds.climate.copernicus.eu/cdsapp#!/dataset/projections-cmip5-daily-single-levels[Copernicus Climate Data Store] comparing delta with CQL2 expression `(tasmax - tasmin) > 10` visualized in QGIS
image::images/cql2-tas-delta.png[width=700,align="center"]

CQL2 expressions can also be used for queries using attributes of vector features.
The following examples use a collection of building polygon features in Ottawa extracted from the OpenStreetMap dataset, filtering buildings using both a spatial subset and the `name` attribute of the features.

This first example illustrates querying for the National Arts Centre at ISEA3H level 30:

https://maps.gnosis.earth/ogcapi/collections/osm:ottawa:buildings/dggs/ISEA3H/zones?subset=Lat(45.4198:45.4264),Lon(-75.704:-75.6935)&filter=name='National%20Arts%20Centre'&zone-level=30&f=json["\https://maps.gnosis.earth/ogcapi/collections/osm:ottawa:buildings/dggs/ISEA3H/zones?subset=Lat(45.4198:45.4264),Lon(-75.704:-75.6935)&filter=name='National Arts Centre'&zone-level=30"]

[#img_cql2_isea3h_nac='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS for Ottawa buildings (© https://openstreetmap.org/[OpenStreetMap] contributors) with CQL2 expression `name='National Arts Centre'` at level 30, visualized in QGIS
image::images/cql2-isea3h-building.png[width=500,align="center"]

This second example illustrates querying for the East Block at ISEA9R level 15 (corresponding to ISEA3H level 30):

https://maps.gnosis.earth/ogcapi/collections/osm:ottawa:buildings/dggs/ISEA9R/zones?subset=Lat(45.4198:45.4264),Lon(-75.704:-75.6935)&filter=name='East%20Block'&zone-level=15&f=json["\https://maps.gnosis.earth/ogcapi/collections/osm:ottawa:buildings/dggs/ISEA9R/zones?subset=Lat(45.4198:45.4264),Lon(-75.704:-75.6935)&filter=name='East Block'&zone-level=15"]

[#img_cql2_isea9r_east='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA9R DGGRS for Ottawa buildings (© https://openstreetmap.org/[OpenStreetMap] contributors) with CQL2 expression `name='East Block'` at level 15, visualized in QGIS
image::images/cql2-isea9r-building.png[width=700,align="center"]

This third example illustrates querying for the Centre Block at GNOSIS Global Grid level 24 (corresponding approximately to same resolution):

https://maps.gnosis.earth/ogcapi/collections/osm:ottawa:buildings/dggs/GNOSISGlobalGrid/zones?subset=Lat(45.4198:45.4264),Lon(-75.704:-75.6935)&filter=name=%27Centre%20Block%27&zone-level=24&f=json["\https://maps.gnosis.earth/ogcapi/collections/osm:ottawa:buildings/dggs/GNOSISGlobalGrid/zones?subset=Lat(45.4198:45.4264),Lon(-75.704:-75.6935)&filter=name='Centre Block'&zone-level=24"]

[#img_cql2_ggg_centre='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying GNOSIS Global Grid DGGRS for Ottawa buildings (© https://openstreetmap.org/[OpenStreetMap] contributors) with CQL2 expression `name='Centre Block'` at level 24, visualized in QGIS
image::images/cql2-ggg-building.png[width=700,align="center"]

A future extension could also enable cross-collection queries, possibly using a `joinCollections` query parameter which would make queryables from different collections available.

=== Retrieving data for a DGGRS Zone

Data can be retrieved for a parent zone of interest, including values for all sub-zones within it, at the `.../dggs/{dggrsId}/zones/{zoneId}/data` resource path.

The following examples illustrate this capability for different DGGRSs, representation encodings, CRSs, and other query parameters.

==== Retrieving data from an ISEA3H DGGRS

Examples in this section retrieve data for pentagonal and hexagonal zones of an <<isea3h-dggrs, ISEA3H DGGRS>>, based on the ISEA projection.

This first example retrieves elevation data for the GEBCO collection for ISEA3H zone `A2-0-A` at a relative depth of 8.
The default zone depth is 10 for this DGGRS in this particular deployment of a DGGS API, as specified in the `defaultDepth` property of the <<isea3h-dggs-description-response,ISEA3H DGGRS description response>>).
These requests override this default by using the `zone-depth` query parameter defined in the <<rc_data-custom-depths,"Data Custom Depths">> requirements class.

===== DGGS-JSON Examples

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A2-0-A/data?zone-depth=8&f=json[\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A2-0-A/data?zone-depth=8]

A snippet of the DGGS-JSON response follows, including an array of elevation values ordered as per the <<isea3h_order_vertex,deterministic zone order defined by this ISEA3H DGGRS>>.

[%unnumbered%]
[source,json]
----
{
   "dggrs" : "https://www.opengis.net/def/dggrs/OGC/1.0/ISEA3H",
   "zoneId" : "A2-0-A",
   "depths" : [ 8 ],
   "values" : {
      "Elevation" : [
         {
            "depth" : 8,
            "shape" : { "count" : 5536, "subZones" : 5536 },
            "data" : [ -14.209265189621, 57.2747655762701, ..., 2075.7176486103044 ]
         }
      ]
   }
}
----

[[img_zone_data]]
[#img_zone_data='{figure-caption} {counter:figure-num}']
.Visualization of a DGGS-JSON response for retrieving data for ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A2-0-A[A2-0-A] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 8
image::images/isea3h-elevation.png[width=700,align="center"]

===== GeoTIFF Examples

In a https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A2-0-A/data?zone-depth=8&f=geotiff[GeoTIFF representation], rather than being quantized to sub-zones, the Elevation would be quantized to the closest rectilinear gridded coverage cells, at a resolution high enough to include at least
one value per corresponding sub-zones. The data may still be clipped to the shape of the zone geometry.
By default, this implementation of the DGGS API Standard returns the data in an OGC:CRS84 CRS.

[#img_zone_data_tiff_wgs84='{figure-caption} {counter:figure-num}']
.Visualization of a CRS84 GeoTIFF response for retrieving data for ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A2-0-A[A2-0-A] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 8
image::images/tiff-zoneDataWGS84.png[width=700,align="center"]

Visualizing this data on 3D globe would look like the following image.

[#img_zone_data_tiff_reprojected='{figure-caption} {counter:figure-num}']
.Visualization on a 3D Globe of a GeoTIFF response for retrieving data for ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A2-0-A[A2-0-A] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 8
image::images/tiff-zoneDataReprojected.png[width=700,align="center"]

Alternatively, the DGGS API implementation also supports the `crs` query parameter to select the https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A2-0-A/data?zone-depth=8&f=geotiff&crs=%5BOGC:1534%5D[ISEA planar projection as an alternate CRS].
In this CRS, this pentagonal zone spans the interruption between two triangles of the base icosahedron.

[#img_zone_data_tiff_isea='{figure-caption} {counter:figure-num}']
.Visualization of an ISEA planar projection GeoTIFF response for retrieving data for pentagonal ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A2-0-A[A2-0-A] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 8
image::images/tiff-zoneDataISEA.png[width=600,align="center"]

A major inconvenience of the ISEA planar projection is that hexagonal zones further along the interruptions will be split on each side on the interruption,
resulting in a large separation between the two halves of the data, as illustrated for example with zone C2-4-A.

[#img_zone_data_tiff_split_hex='{figure-caption} {counter:figure-num}']
.Visualization of an ISEA planar projection GeoTIFF response for retrieving data for ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/C2-4-A[C2-4-A] (a hexagon split across an ISEA interruption) of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry]
image::images/tiff-ISEA-splitHex.png[width=750,align="center"]

On the other hand, a hexagon not spanning an interruption will appear in the ISEA planar projection as typical hexagons with two edges aligned with either the horizontal (for odd parent zone levels) or vertical axis (for even levels).

[#img_zone_data_tiff_vertical_hex='{figure-caption} {counter:figure-num}']
.Visualization of an ISEA planar projection GeoTIFF response for retrieving data for ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A0-0-F[A0-0-F] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry]
image::images/tiff-zoneDataISEA-HorizontalHex.png[width=700,align="center"]

[#img_zone_data_tiff_horizontal_hex='{figure-caption} {counter:figure-num}']
.Visualization of an ISEA planar projection GeoTIFF response for retrieving data for ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/B0-5-A[B0-5-A] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry]
image::images/tiff-zoneDataISEA-VerticalHex.png[width=700,align="center"]

whereas the same zones in OGC:CRS84 will have various shapes not easily recognizable as hexagons:

[#img_zone_data_tiff_wgs84_vertical_hex='{figure-caption} {counter:figure-num}']
.Visualization of a GeoTIFF response in OGC:CRS84 for retrieving data for ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A0-0-F[A0-0-F] (odd level 1) of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry]
image::images/tiff-zoneDataWGS84-HorizontalHex.png[width=700,align="center"]

[#img_zone_data_tiff_wgs84_horizontal_hex='{figure-caption} {counter:figure-num}']
.Visualization of a GeoTIFF response in OGC:CRS84 for retrieving data for ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/B0-5-A[B0-5-A] (even level 2) of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry]
image::images/tiff-zoneDataWGS84-VerticalHex.png[width=700,align="center"]

While both DGGS-JSON and GeoTIFF are encodings appropriate for raster data, DGGS-JSON is better suited for representing values quantized to the hierarchical discrete global grids.
Encoding vector data in these formats essentially implies rasterizing the vector features, using either a selection of the feature properties as values, or numerical feature identifiers
for which associated properties may be queryable elsewhere (e.g., in an http://www.opengis.net/doc/IS/ogcapi-features-1/1.0.1[OGC API - Features] deployment).

===== GeoJSON Examples

Although gridded elevation and bathymetry data is better suited to raster formats such as DGGS-JSON and GeoTIFF, a GeoJSON and/or Features & Geometry JSON representation
could also be offered where each zone is represented as a feature, with the associated property providing the data values such as the elevation.
This would be equivalent to the <<rc_zone-geojson,GeoJSON representation for a zone list>> where `compact-zones` is set to `false`, the `parent-zone` is the zone for which data is requested,
and the `zone-level` is the sum of the parent zone plus the relative zone depth at which data is requested (the default depth or `zone-depth` query parameter), with the addition of these
properties associating data values with each zone.

If the geometry for these zone features is provided as polygons (`geometry=zone-region`), visualizing this vector data would produce an output like the following partial response,
which would result in a visualization identical to <<img_zone_data>>.

[%unnumbered%]
[source,json]
----
{
   "type" : "FeatureCollection",
   "features" : [ {
      "type" : "Feature",
      "id" : 1,
      "geometry" : {
         "type" : "Polygon",
         "coordinates" : [ [
            [-77.51874470, 68.96298626], [-77.598412, 68.94863327],
            [-77.67832934, 68.93432964], [-77.75852144, 68.92009304],
            [-77.83901433, 68.90594517], [-77.91983505, 68.8919127],
            ...
            [-77.52048177, 68.99500861], [-77.51874470, 68.96298626]
         ]
      },
      "properties" : {
         "Elevation" : -14.209265189621,
         "zoneID" : "E0-8C1-A"
      }
   }, {
      "type" : "Feature",
      "id" : 2,
      ...
----

Alternatively, the geometry of each zone could also be provided as a single point for its centroid (`geometry=zone-centroid`), in which case the response and associated visualization would look like the following:

[%unnumbered%]
[source,json]
----
{
   "type" : "FeatureCollection",
   "features" : [ {
      "type" : "Feature",
      "id" : 1,
      "geometry" : {
         "type" : "Point",
         "coordinates" : [-78.7500000030306, 69.2228046463321]
      },
      "properties" : {
         "Elevation" : -14.209265189621,
         "zoneID" : "E0-8C1-A"
      }
   }, {
      "type" : "Feature",
      "id" : 2,
      "geometry" : {
         "type" : "Point",
         "coordinates" : [-82.3566944995815, 68.4176458502864]
      },
      "properties" : {
         "Elevation" : 57.2747655762701,
         "zoneID" : "E0-911-A"
      }
   },
   ...
----

[#img_zone_data_geojson_points='{figure-caption} {counter:figure-num}']
.Visualization of a GeoJSON point features response for data retrieved from ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A2-0-A[A2-0-A] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 8
image::images/geoJSON-points-elevation.png[width=700,align="center"]

For data of a vector nature, a vector format such as GeoJSON allows to encode zone data response in a more compact manner without having to rasterize the data.
Ideally, especially for features spanning a large spatial extent (such as country boundaries, or the coastline of a large landmass), the features would be clipped to the geometry of the zone for which data
is being requested, or as least to limited extent around the zone.
Unfortunately, GeoJSON and JSON-FG do not yet have a standard mechanism to identify artificial edges which may result from such clipping.
This complicates re-joining features spread across multiple zones, and may result in rendering artifacts for polygonal features when rendered with a stroke,
as the stroke would also be drawn on those artificial segments at the bound edges.

The following response for a zone data request and its visualization illustrates vector features in Ottawa from OpenStreetMap returned as GeoJSON.
The features and geometry coordinates in this case have no relation to sub-zones, and are only clipped to the zone for which data is being requested.
The zone depth (default zone depth of 10 in this case) can however control cartographic generalization of the geometry.
This could potentially include filtering point features, based on rules associated with the dataset, as decided by the implementation, as well as the precision of the coordinates.

https://maps.gnosis.earth/ogcapi/collections/osm:ottawa:roads/dggs/ISEA3H/zones/I0-1EEBFA7-E/data?f=geojson[\https://maps.gnosis.earth/ogcapi/collections/osm:ottawa:roads/dggs/ISEA3H/zones/I0-1EEBFA7-E/data]

[%unnumbered%]
[source,json]
----
{
   "type" : "FeatureCollection",
   "features" : [ {
      "type" : "Feature",
      "id" : 2305843009218664049,
      "geometry" : {
         "type" : "LineString",
         "coordinates" : [
            [-75.70190343, 45.42180362],
            [-75.70214786, 45.4220908],
            [-75.70255148, 45.42257149]
         ]
      },
      "properties" : {
         "highway" : "service",
         "name" : "Parliament Road",
         "name:fr" : "chemin Parliament",
         "access" : "no"
      }
   }, {
      "type" : "Feature",
      "id" : 2305843009218664071,
      "geometry" : {
         "type" : "LineString",
         "coordinates" :
   ...
----

[#img_zone_data_geojson_osmOttawa='{figure-caption} {counter:figure-num}']
.Visualization in a world Mercator projection of a GeoJSON feature collection with mixed geometry types for data retrieved from ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/osm:ottawa/dggs/ISEA3H/zones/I0-1EEBFA7-E[I0-1EEBFA7-E] of https://openstreetmap.org/[OpenStreetMap] (c) OpenStreetMap contributors
image::images/geojson-osmOttawa.png[width=700,align="center"]

In an ISEA planar projection, the same data could be visualized as follows.

[#img_zone_data_geojson_osmOttawaISEA='{figure-caption} {counter:figure-num}']
.Visualization in an ISEA planar projection of a GeoJSON feature collection with mixed geometry types for data retrieved from ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/osm:ottawa/dggs/ISEA3H/zones/I0-1EEBFA7-E[I0-1EEBFA7-E] of https://openstreetmap.org/[OpenStreetMap] (c) OpenStreetMap contributors
image::images/geojson-osmOttawaISEA.png[width=700,align="center"]

The following zone data request is for https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry[bathymetry polygons] from the https://naturalearthdata.com/[Natural Earth] physical features.

https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry:ne_10m_bathymetry_L_0/dggs/ISEA3H/zones/B0-5-A/data?f=geojson[\https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry:ne_10m_bathymetry_L_0/dggs/ISEA3H/zones/B0-5-A/data]

[%unnumbered%]
[source,json]
----
{
   "type": "FeatureCollection",
   "features": [
      {
         "type": "Feature",
         "id": 1,
         "properties": {
            "scalerank": 0,
            "featurecla": "Bathymetry"
         },
         "geometry": {
            "type": "MultiPolygon",
            "coordinates": [
               [
                  [ [ -55.63744954, 59.87006944 ], [ -56.91595155, 59.7924323 ],
                    [ -58.19026295, 59.70335469 ], [ -59.45970834, 59.60311811 ],
                    [ -60.72365746, 59.49204741 ], [ -61.98152851, 59.37051649 ],
                    ...
----

[#img_zone_data_geojson_bathymetry='{figure-caption} {counter:figure-num}']
.Visualization in a North polar projection of GeoJSON polygon contour features for data retrieved from ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry/dggs/ISEA3H/zones/B0-5-A[B0-5-A] of https://naturalearthdata.com/[Natural Earth] bathymetry contours.
image::images/geojson-bathymetry.png[width=700,align="center"]

[#img_zone_data_geojson_bathymetryISEA='{figure-caption} {counter:figure-num}']
.Visualization in an ISEA planar projection of GeoJSON polygon contour features for data retrieved from ISEA3H DGGRS zone https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry/dggs/ISEA3H/zones/B0-5-A[B0-5-A] of https://naturalearthdata.com/[Natural Earth] bathymetry contours.
image::images/geojson-bathymetryISEA.png[width=700,align="center"]

===== DGGS-JSON-FG Examples

The DGGS-JSON-FG format is the vector counterpart to DGGS-JSON, leveraging the same concepts of DGGRS, parent zone, sub-zones at a given relative depth, and deterministic sub-zone order,
while also building on top of the familiar Features & Geometry JSON and GeoJSON formats, which are themselves built on OGC Simple Features.

In DGGS-JSON-FG, spatial coordinates of the feature geometries corresponding to the spatial dimensions of the DGGRS are encoded as integer sub-zone order indices ranging from 1 to the
number of sub-zones at the selected relative depth. This relative depth corresponds to the precision of the coordinates at which geometry is being defined, analogous to the number of decimals
that would be used in GeoJSON or JSON-FG. Because this essentially corresponds to a coordinate system local to the zone for which data is being retrieved, high precision can be achieved
with much fewer information than is required to address the entire globe.

This representation also addresses the issue of artificial segments. This is done by using a special zone order index value of _0_ for representing coordinates outside of the zone,
which facilitates merging geometry across adjacent zones and easily identifying artificial segments of polygon contours.
For polygons, rather than tracing points along the clipping zone edge(s), only the exit and entry points will exist with a single _0_ coordinate value in between, indicating that the portion of the zone
edge(s) between those two points is within the contour. A DGGS-JSON-FG representation is requested using the `application/geo+json` media type together with the `profile` query parameter set to a value of `jsonfg-dggs`, `jsonfg-dggs-plus`, `jsonfg-dggs-zoneids` or `jsonfg-dggs-zoneids-plus`.

The DGGS-JSON-FG representation for the previous OpenStreetMap example extract follows, at a relative depth precision of 15,
resulting in coordinates within a ~275 cm² region, ~16 cm precision, with sub-zone indices between 1 and 14,355,469 (roughly equivalent to latitude and longitude with six decimal places).

[%unnumbered%]
[source,json]
----
include::../examples/3-osmOttawa-extract.dggsjsonfg[]
----

The DGGS-JSON-FG representation for the previous arctic bathymetry polygons example extract follows, at a relative depth precision of 15,
resulting in coordinates within a ~0.39 km² region (the size of the previous OpenStreetMap example level 17 zone),
~627 m precision, with sub-zone indices between 1 and 14,355,469 (equivalent to decimal latitude and longitude between two and three decimal places).

[%unnumbered%]
[source,json]
----
include::../examples/4-arcticBathymetry-extract.dggsjsonfg[]
----

==== Retrieving data from an ISEA9R DGGRS

Examples in this section retrieve data for rhombic zones of an <<isea9r-dggrs, ISEA9R DGGRS>>, based on the ISEA projection.

===== DGGS-JSON Examples

The following request is for data from the A2-0 level 0 rhombic ISEA9R zone at a relative depth of 4 in DGGS-JSON:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones/A2-0/data?zone-depth=4&f=json[\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones/A2-0/data?zone-depth=4]

[%unnumbered%]
[source,json]
----
{
   "dggrs" : "https://www.opengis.net/def/dggrs/OGC/1.0/ISEA9R",
   "zoneId" : "A2-0",
   "depths" : [ 4 ],
   "values" : {
      "Elevation" : [
         {
            "depth" : 4,
            "shape" : { "count" : 6561, "subZones" : 6561 },
            "data" : [ -684.1801215563401, -725.808053553661, ..., -4279.7074446855995 ]
         }
      ]
   }
}
----

[[img_zone_data_isea9r]]
[#img_zone_data_isea9r='{figure-caption} {counter:figure-num}']
.Visualization in the ISEA 5x6 rotated and sheared space of a DGGS-JSON response for retrieving data for ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones/A2-0[A2-0] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 4
image::images/isea9r-gebco-5x6.png[width=700,align="center"]

[#img_zone_data_isea9r_isea='{figure-caption} {counter:figure-num}']
.Visualization in an ISEA planar projection of a DGGS-JSON response for retrieving data for ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones/A2-0[A2-0] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 4
image::images/isea9r-gebco-isea.png[height=800,align="center"]

[#img_zone_data_isea9r_ortho='{figure-caption} {counter:figure-num}']
.Visualization in an orthographic projection of a DGGS-JSON response for retrieving data for ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones/A2-0[A2-0] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 4
image::images/isea9r-gebco-orthographic.png[height=800,align="center"]

===== GeoTIFF Examples

The following illustrates the GeoTIFF response for requesting data from the same A2-0 ISEA9R zone at same relative depth of 4 in three different CRSs:
https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones/A2-0/data?zone-depth=4&f=tiff&crs=%5BOGC:153456%5D[5x6 ISEA rotated and sheared space],
https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones/A2-0/data?zone-depth=4&f=tiff&crs=%5BOGC:1534%5D[ISEA planar projection], and
https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones/A2-0/data?zone-depth=4&f=tiff&crs=%5BOGC:CRS84%5D[CRS84].

[#img_zone_data_isea9r_tiff_5x6='{figure-caption} {counter:figure-num}']
.Visualization in the ISEA 5x6 rotated and shared space of a GeoTIFF response for retrieving data for ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones/A2-0[A2-0] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 4
image::images/isea9r-gebco-tiff-5x6.png[width=600,align="center"]

TIP: Because ISEA9R zone edges are fully aligned with the axes of the ISEA 5x6 rotated and sheared space and the rhombic zones are square in this space,
a GeoTIFF representation provides a one-to-one mapping of zones to rectilinear gridded coverage cells, as can be seen by comparing this previous visualization of the GeoTIFF response with the visualization of the DGGS-JSON responses.
For the same reason, https://maps.gnosis.earth/ogcapi/tileMatrixSets/ISEA9R[an ISEA9R] https://docs.ogc.org/is/17-083r4/17-083r4.html[2D Tile Matrix Set] can be defined in this 5x6 space, which supports
implementing the https://docs.ogc.org/is/20-057/20-057.html[OGC API - Tiles] Standard as an alternative or complementary access mechanism to implementing the Zone Data Retrieval requirements class of this DGGS API.

[#img_zone_data_isea9r_tiff_isea='{figure-caption} {counter:figure-num}']
.Visualization of an ISEA planar projection GeoTIFF response for retrieving data for ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones/A2-0[A2-0] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 4
image::images/isea9r-gebco-tiff-isea.png[height=800,align="center"]

[#img_zone_data_isea9r_tiff_wgs84='{figure-caption} {counter:figure-num}']
.Visualization of a CRS84 GeoTIFF response for retrieving data for ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones/A2-0[A2-0] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 4
image::images/isea9r-gebco-tiff-crs84.png[width=700,align="center"]

TIP: In these two previous visualizations, the server returned a response in the ISEA planar projection and CRS84, respectively.
If the affine transformation from the ISEA 5x6 rotated and sheared space is done on the client side instead, the rhombic shape of the individual sub-zones would be preserved, as in the corresponding visualizations
of the DGGS-JSON representation.

===== GeoJSON Examples

Using centroid points for the geometry of each zone (`geometry=zone-centroid`), the GeoJSON response and associated visualization would look like the following:

[%unnumbered%]
[source,json]
----
{
   "type" : "FeatureCollection",
   "features" : [ {
      "type" : "Feature",
      "id" : 1,
      "geometry" : {
         "type" : "Point",
         "coordinates" : [-78.3336155911744, 31.7735879687561]
      },
      "properties" : {
         "Elevation" : -684.1801215563401,
         "zoneID" : "E2-0"
      }
   }, {
      "type" : "Feature",
      "id" : 2,
   ...
----

[#img_zone_data_isea9r_geojson_points='{figure-caption} {counter:figure-num}']
.Visualization of a GeoJSON point features response for data retrieved from ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones/A2-0[A2-0] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 4
image::images/isea9r-gebco-geojson-points.png[height=800,align="center"]

The following GeoJSON feature collection is requested from an OpenStreetMap dataset of Ottawa for ISEA9R zone I0-1EEBFA7, and illustrated as visualized in different projections.

https://maps.gnosis.earth/ogcapi/collections/osm:ottawa:roads/dggs/ISEA9R/zones/I0-1EEBFA7/data[\https://maps.gnosis.earth/ogcapi/collections/osm:ottawa:roads/dggs/ISEA9R/zones/I0-1EEBFA7/data]

[%unnumbered%]
[source,json]
----
{
   "type": "FeatureCollection",
   "features": [ {
      "type": "Feature",
      "id": 2305843009253710926,
      "geometry": {
         "type": "LineString",
         "coordinates": [
            [ -75.69465583, 45.42431289 ],
            [ -75.69500353, 45.42453159 ],
            [ -75.69543003, 45.4247375 ]
         ]
      },
      "properties": {
         "highway": "path",
         "name": "Rideau Canal Western Pathway",
         "surface": "asphalt",
         "bicycle": "yes",
         "foot": "yes",
         "tunnel": "yes",
         "width": "6"
      }
   }, {
      "type": "Feature",
      "id": 2305843009253711182,
      "geometry": {
         "type": "LineString",
         "coordinates":
   ...
----

[#img_zone_data_isea9r_geojson_osmOttawa_Mercator='{figure-caption} {counter:figure-num}']
.Visualization in a world Mercator projection of a GeoJSON feature collection with mixed geometry types for data retrieved from ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/osm:ottawa/dggs/ISEA9R/zones/I0-1EEBFA7[I0-1EEBFA7] of https://openstreetmap.org/[OpenStreetMap] (c) OpenStreetMap contributors
image::images/isea9r-osmOttawa-Mercator.png[width=700,align="center"]

[#img_zone_data_isea9r_geojson_osmOttawa_ISEA='{figure-caption} {counter:figure-num}']
.Visualization in an ISEA planar projection of a GeoJSON feature collection with mixed geometry types for data retrieved from ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/osm:ottawa/dggs/ISEA9R/zones/I0-1EEBFA7[I0-1EEBFA7] of https://openstreetmap.org/[OpenStreetMap] (c) OpenStreetMap contributors
image::images/isea9r-osmOttawa-isea.png[height=800,align="center"]

[#img_zone_data_isea9r_geojson_osmOttawa_ISEA5x6='{figure-caption} {counter:figure-num}']
.Visualization in ISEA 5x6 rotated and sheared space of a GeoJSON feature collection with mixed geometry types for data retrieved from ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/osm:ottawa/dggs/ISEA9R/zones/I0-1EEBFA7[I0-1EEBFA7] of https://openstreetmap.org/[OpenStreetMap] (c) OpenStreetMap contributors
image::images/isea9r-osmOttawa-5x6.png[width=700,align="center"]

[%unnumbered%]
[source,json]
----
{
   "type": "FeatureCollection",
   "features": [ {
      "type": "Feature",
      "id": 1,
      "properties": {
         "scalerank": 0,
         "featurecla": "Bathymetry"
      },
      "geometry": {
         "type": "MultiPolygon",
         "coordinates": [
            [
               [ [ -176.462294193695101, 51.573747730189602 ],
                 [ -176.299702455578142, 51.743306963471383 ],
                 [ -176.29463468229261, 51.738291979490903 ],
                 [ -176.292808119410552, 51.75049674056649 ],
                 [ -176.271367699388492, 51.77285594050052 ],
                 ...
----

The following GeoJSON polygon contours are requested from Natural Earth bathymetry for ISEA9R zone A9-0.

https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry:ne_10m_bathymetry_L_0/dggs/ISEA9R/zones/A9-0/data[\https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry:ne_10m_bathymetry_L_0/dggs/ISEA9R/zones/A9-0/data]

[#img_zone_data_isea9r_geojson_bathymetry5x6='{figure-caption} {counter:figure-num}']
.Visualization in the ISEA 5x6 rotated and sheared space of GeoJSON polygon contour features for data retrieved from ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry/dggs/ISEA9R/zones/A9-0[A9-0] of https://naturalearthdata.com/[Natural Earth] bathymetry contours.
image::images/isea9r-neBathymetry-5x6.png[width=700,align="center"]

[#img_zone_data_isea9r_geojson_bathymetryISEA='{figure-caption} {counter:figure-num}']
.Visualization in an ISEA planar projection of GeoJSON polygon contour features for data retrieved from ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry/dggs/ISEA9R/zones/A9-0[A9-0] of https://naturalearthdata.com/[Natural Earth] bathymetry contours.
image::images/isea9r-neBathymetry-ISEA.png[height=800,align="center"]

[#img_zone_data_isea9r_geojson_bathymetry='{figure-caption} {counter:figure-num}']
.Visualization in a Mollweide projection of GeoJSON polygon contour features for data retrieved from ISEA9R DGGRS zone https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry/dggs/ISEA9R/zones/A9-0[A9-0] of https://naturalearthdata.com/[Natural Earth] bathymetry contours.
image::images/isea9r-neBathymetry-Mollweide.png[height=800,align="center"]

==== Retrieving data from a GNOSIS Global Grid DGGRS

Examples in this section retrieve data for rectangular zones of a <<ggg-dggrs, GNOSIS Global Grid DGGRS>>, with edges aligned to the geographic latitude and longitude axes.

===== DGGS-JSON Examples

The following request is for data from the 0-1-3 level 0 GNOSIS Global Grid zone in DGGS-JSON at a relative depth of 7:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones/0-1-3/data?zone-depth=7&f=json[\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones/0-1-3/data?zone-depth=7]

[%unnumbered%]
[source,json]
----
{
   "dggrs" : "https://www.opengis.net/def/dggrs/OGC/1.0/GNOSISGlobalGrid",
   "zoneId" : "0-1-3",
   "depths" : [ 7 ],
   "values" : {
      "Elevation" : [
         {
            "depth" : 7,
            "shape" : { "count" : 10923, "subZones" : 10923 },
            "data" : [ -4062.7933481641721, -4645.8313990445513, ..., 2878.8939861844092 ]
         }
      ]
   }
}
----

[[img_zone_data_ggg]]
[#img_zone_data_ggg='{figure-caption} {counter:figure-num}']
.Visualization of CRS84 DGGS-JSON response for retrieving data for GNOSIS Global Grid DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones/0-1-3[0-1-3] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 7
image::images/ggg-gebco-crs84.png[width=700,align="center"]

TIP: Notice how there are fewer zones per rows approaching the poles, until there is a single zone at the final polar row.
While not achieving the 1% error budget allowed for a DGGH to qualify as being equal area, the use of the https://docs.ogc.org/is/17-083r4/17-083r4.html#variable-matrixwidth-tile-matrix[Variable Width 2D Tile Matrix Set] concept allows
the GNOSIS Global Grid to maintain a divergence in area from mean zone surface area below 50% up to a high refinement level, with zones aligned to the geodetic latitude and longitude axes.
This in turn greatly facilitates data integration from other discrete global grid hierarchies as well as arbitrary data sources, as no re-projection is needed for WGS84 coordinates.

[#img_zone_data_ggg_ortho='{figure-caption} {counter:figure-num}']
.Visualization in an orthographic projection of a DGGS-JSON response for retrieving data for GNOSIS Global Grid DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones/0-1-3[0-1-3] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 7
image::images/ggg-gebco-orthographic.png[width=700,align="center"]

===== GeoTIFF Examples

The following illustrates the https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones/0-1-3/data?zone-depth=7&f=tiff[GeoTIFF response] for requesting data from the
same 0-1-3 GNOSIS Global Grid zone at same relative depth of 7, visualized below in both its native CRS84 and an orthographic projection.

[#img_zone_data_ggg_tiff='{figure-caption} {counter:figure-num}']
.Visualization of CRS84 GeoTIFF response for retrieving data for GNOSIS Global Grid DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones/0-1-3[0-1-3] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 7
image::images/ggg-gebco-tiff-crs84.png[width=600,align="center"]

TIP: As can be seen by comparing this previous visualization of the GeoTIFF response with the visualization of the DGGS-JSON responses,
because the GNOSIS Global Grid zone edges are fully aligned with geographic latitude and longitude, a GeoTIFF representation provides a one-to-one mapping of zones to rectilinear gridded coverage cells,
with the exception of the GeoTIFF representation having a fixed width, requiring to duplicate the values of zones approaching the pole.

TIP: A registered https://docs.ogc.org/is/17-083r4/17-083r4.html#toc58[GNOSIS Global Grid 2D Tile Matrix Set] is defined which supports implementing
the https://docs.ogc.org/is/20-057/20-057.html[OGC API - Tiles] Standard as an alternative or complementary access mechanism to implementing the Zone Data Retrieval requirements class of this DGGS API.

[#img_zone_data_ggg_tiff_ortho='{figure-caption} {counter:figure-num}']
.Visualization in an orthographic projection of GeoTIFF response for retrieving data for GNOSIS Global Grid DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones/0-1-3[0-1-3] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 7
image::images/ggg-gebco-tiff-orthographic.png[width=600,align="center"]

===== GeoJSON Examples

Using centroid points for the geometry of each zone (`geometry=zone-centroid`), the GeoJSON response and associated visualization would look like the following:

[%unnumbered%]
[source,json]
----
{
   "type" : "FeatureCollection",
   "features" : [ {
      "type" : "Feature",
      "id" : 1,
      "geometry" : {
         "type" : "Point",
         "coordinates" : [90.3515625, -0.3515625]
      },
      "properties" : {
         "Elevation" : -4062.7933481641721,
         "zoneID" : "7-80-180"
      }
   }, {
      "type" : "Feature",
      "id" : 2,
      ...
----

[#img_zone_data_ggg_geojson_points='{figure-caption} {counter:figure-num}']
.Visualization of a GeoJSON point features response for data retrieved from GNOSIS Global Grid DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones/0-1-3[0-1-3] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 7
image::images/ggg-gebco-geojson-points.png[width=700,align="center"]

TIP: The fewer zones approaching the poles based on the https://docs.ogc.org/is/17-083r4/17-083r4.html#variable-matrixwidth-tile-matrix[Variable Width 2D Tile Matrix Set] concept are especially noticeable in these visualizations
of the sub-zone centroids as points, illustrating how the GNOSIS Global Grid achieves a rough approximation of equal area despite zone edges being aligned to geographic latitude and longitude.

[#img_zone_data_ggg_geojson_points_ortho='{figure-caption} {counter:figure-num}']
.Visualization in an orthographic projection of a GeoJSON point features response for data retrieved from GNOSIS Global Grid DGGRS zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones/0-1-3[0-1-3] of https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] at a relative depth of 7
image::images/ggg-gebco-geojson-points-orthographic.png[width=700,align="center"]

The following GeoJSON feature collection is requested from an OpenStreetMap dataset of Singapore for GNOSIS Global Grid level 12 zone C-FC5-3276:

https://maps.gnosis.earth/ogcapi/collections/osm:singapore:roads/dggs/GNOSISGlobalGrid/zones/C-FC5-3276/data[\https://maps.gnosis.earth/ogcapi/collections/osm:singapore:roads/dggs/GNOSISGlobalGrid/zones/C-FC5-3276/data]

The map below visualizes that zone together with the zone immediately East of it, C-FC5-3277:

https://maps.gnosis.earth/ogcapi/collections/osm:singapore:roads/dggs/GNOSISGlobalGrid/zones/C-FC5-3277/data[\https://maps.gnosis.earth/ogcapi/collections/osm:singapore:roads/dggs/GNOSISGlobalGrid/zones/C-FC5-3277/data]

[%unnumbered%]
[source,json]
----
{
   "type" : "FeatureCollection",
   "features" : [ {
      "type" : "Feature",
      "id" : 2305843009223282082,
      "geometry" : {
         "type" : "LineString",
         "coordinates" :
            [ [103.842845400531, 1.2916332189689], [103.8427734375, 1.2916700596819] ]
      },
      "properties" : {
         "highway" : "residential",
         "name" : "Unity Street",
         "surface" : "asphalt",
         "lanes" : "2",
         "turn:lanes:forward" : "through",
         "lanes:backward" : "1",
         "lanes:forward" : "1",
         "turn:lanes:backward" : "left"
      }
   }, {
      "type" : "Feature",
      "id" : 2305843009223284260,
      ...
----

TIP: Notice the artificial edge drawn with a grey stroke splitting the _Flower Dome_ in two, around the middle of the map.
With the artificial edge information of DGGS-JSON-FG, a client could avoid such visualization artifacts, and could more easily recombine geometry split across separate zones.

[#img_zone_data_ggg_geojson_osmSingapore='{figure-caption} {counter:figure-num}']
.Visualization of a GeoJSON feature collection with mixed geometry types for data retrieved from GNOSIS Global Grid DGGRS zones https://maps.gnosis.earth/ogcapi/collections/osm:singapore/dggs/GNOSISGlobalGrid/zones/C-FC5-3276[C-FC5-3276] and https://maps.gnosis.earth/ogcapi/collections/osm:singapore/dggs/GNOSISGlobalGrid/zones/C-FC5-3277[C-FC5-3277] of https://openstreetmap.org/[OpenStreetMap] (c) OpenStreetMap contributors
image::images/ggg-osmSingapore-crs84.png[width=700,align="center"]

The following GeoJSON polygon contours are requested from Natural Earth bathymetry for GNOSIS Global Grid level 0 zone 1-1-7.

https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry:ne_10m_bathymetry_L_0/dggs/GNOSISGlobalGrid/zones/1-1-7/data[\https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry:ne_10m_bathymetry_L_0/dggs/GNOSISGlobalGrid/zones/1-1-7/data]

[%unnumbered%]
[source,json]
----
{
   "type" : "FeatureCollection",
   "features" : [ {
      "type" : "Feature",
      "id" : 1,
      "geometry" : {
         "type" : "Polygon",
         "coordinates" : [
            [ [136.0693439846182, 33.8470804339864],
              [136.0242801226881, 33.75],
              [135.9791304248306, 33.6527478941586],
              [135.9583581303791, 33.6329197949094],
              [135.9327790239883, 33.6112033052555],
              ...
----

[#img_zone_data_ggg_geojson_bathymetry='{figure-caption} {counter:figure-num}']
.Visualization of GeoJSON polygon contour features for data retrieved from GNOSIS Global Grid DGGRS zone https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry/dggs/GNOSISGlobalGrid/zones/1-1-7[1-1-7] of https://naturalearthdata.com/[Natural Earth] bathymetry contours.
image::images/ggg-neBathymetry-crs84.png[width=700,align="center"]

[#img_zone_data_ggg_geojson_bathymetryOrtho='{figure-caption} {counter:figure-num}']
.Visualization in an orthographic projection of GeoJSON polygon contour features for data retrieved from GNOSIS Global Grid DGGRS zone https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:physical:bathymetry/dggs/GNOSISGlobalGrid/zones/1-1-7[1-1-7] of https://naturalearthdata.com/[Natural Earth] bathymetry contours.
image::images/ggg-neBathymetry-orthographic.png[width=700,align="center"]

=== Requesting data at a particular relative depth

Implementations supporting the `zone-depth` query parameter defined in the <<rc_data-custom-depths,"Data Custom Depths">> requirements class allows clients to request data at a particular depth.

For example, the two following requests and visualized responses illustrate retrieving zones at relative depths of 4 (91 sub-zone values) and 9 (19,927 sub-zone values), respectively, for ISEA3H zone
https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/H4-A825C-A[_H4-A825C-A_]:

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/H4-A825C-A/data?zone-depth=4&datetime=2020-07-31&properties=B08&f=json["\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/H4-A825C-A/data?zone-depth=4&datetime=2020-07-31&properties=B08"]

[#img_isea3h_depth_4='{figure-caption} {counter:figure-num}']
.Visualization of near-infrared band (`B08`) of ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/H4-A825C-A[H4-A825C-A] at relative depth of 4 from https://sentinel.esa.int/web/sentinel/missions/sentinel-2[Copernicus SENTINEL-2 operated by ESA]
image::images/sentinel2-isea3h-depth-4.png[width=400,align="center"]

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/H4-A825C-A/data?zone-depth=9&datetime=2020-07-31&properties=B08&f=json["\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/H4-A825C-A/data?zone-depth=9&datetime=2020-07-31&properties=B08"]

[#img_isea3h_depth_4='{figure-caption} {counter:figure-num}']
.Visualization of near-infrared band (`B08`) of ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/H4-A825C-A[H4-A825C-A] at relative depth of 9 from https://sentinel.esa.int/web/sentinel/missions/sentinel-2[Copernicus SENTINEL-2 operated by ESA]
image::images/sentinel2-isea3h-depth-9.png[width=700,align="center"]

=== Subsetting and filtering zone data

In addition to the basic retrieval of zone data, implementations can support additional query parameters for the `.../zones/{zoneId}/data` resources to return only a portion of the data associated with the zone.
The `subset`, `datetime` and `properties` query parameters are defined in the <<rc_data-subsetting,Data Subsetting>> requirements class, while the `filter` query parameter is defined in the <<rc_data-cql2-filter, Filtering Zone Data with CQL2>> requirements class.

==== Temporal subsetting

It is possible to retrieve only a portion of a temporal datasets using one of two query parameters: `datetime`, or `subset` with the `time` dimension.
The temporal subset can be either a slice specified using a single time instant, or a trim using a lower and upper bound.

<<<

The following examples retrieve data from a sentinel-2 collection for the 28th of April, May and June 2022, at relative depth of 12, for ISEA3H zone E7-17D1-A in New Zealand.
Since the sentinel-2 dataset does not have imagery for the whole globe at every instant, the server will return the latest imagery available before the specified time instant.

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/E7-17D1-A/data?zone-depth=12&crs=OGC:1534&datetime=2022-04-28[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/E7-17D1-A/data?zone-depth=12&datetime=2022-04-28]

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/E7-17D1-A/data?zone-depth=12&crs=OGC:1534&datetime=2022-05-28[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/E7-17D1-A/data?zone-depth=12&datetime=2022-05-28]

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/E7-17D1-A/data?zone-depth=12&crs=OGC:1534&datetime=2022-06-28[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/E7-17D1-A/data?zone-depth=12&datetime=2022-06-28]

[#img_datetime-sentinel2-nz='{figure-caption} {counter:figure-num}']
.Visualization of different temporal slices for ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/E7-17D1-A[E7-17D1-A] (New Zealand) from https://sentinel.esa.int/web/sentinel/missions/sentinel-2[Copernicus SENTINEL-2 operated by ESA]
image::images/datetime-sentinel2-nz.png[width=700,align="center"]

TIP: Although the examples illustrated here are all for rasterized data, temporal subsetting (whether using the `datetime` or `subset=time(...)` syntax) can also be applied
to feature collections with vector geometry with a primary temporal property.

<<<

The following examples retrieve data from a sentinel-2 collection for the 15th of February and May 2021, and for the 28th of October 2022, at relative depth of 12, for ISEA3H zone G7-67252-D in K'gari, Australia.

// Fraser Island

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&crs=OGC:1534&datetime=2021-02-15[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&datetime=2021-02-15]

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&crs=OGC:1534&datetime=2021-05-15[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&datetime=2021-05-15]

// https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&crs=OGC:1534&datetime=2021-08-15[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&datetime=2021-08-15]

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&crs=OGC:1534&datetime=2022-10-28[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&datetime=2022-10-28]

[#img_datetime-sentinel2-kgari='{figure-caption} {counter:figure-num}']
.Visualization of different temporal slices for ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D[G7-67252-D] (K'gari, Australia) from https://sentinel.esa.int/web/sentinel/missions/sentinel-2[Copernicus SENTINEL-2 operated by ESA]
image::images/datetime-sentinel2-kgari.png[width=700,align="center"]

The following examples retrieve data from a daily CMIP5 climate dataset for the time interval between October 6th to October 10th, 2022 for ISEA3H zone A1-0-E, at a relative depth of 8.

https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/ISEA3H/zones/A1-0-E/data?zone-depth=8&datetime=2022-10-06/2022-10-10&f=json[\https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/ISEA3H/zones/A1-0-E/data?zone-depth=8&datetime=2022-10-06/2022-10-10]

The following JSON data illustrates an extract of a DGGS-JSON response for this request for the precipitation and wind speed variables.
In addition to the sub-zones, this DGGS-JSON sample has temporal dimension for the 7 days of the response.

[%unnumbered%]
[source,json]
----
{
   "dggrs" : "[ogc-dggrs:ISEA3H]",
   "zoneId" : "A1-0-E",
   "depths" : [ 8 ],
   "schema":
   {
      "$schema" : "https://json-schema.org/draft/2020-12/schema",
      "$id" : "https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/schema",
      "title" : "Climate variables",
      "type": "object",
      "properties":
      {
         ...
         "pr": {
            "type": "number",
            "title": "Mean precipitation flux",
            "description": "Amount of water per unit area and time",
            "x-ogc-propertySeq" : 2,
            "x-ogc-unit": "kg/m2/s",
            "x-ogc-definition": "https://qudt.org/vocab/quantitykind/Flux"
         },
         ...
         "sfcWind": {
            "type": "number",
            "title": "Wind speed",
            "description": "Magnitude of the two-dimensional horizontal air velocity near the surface",
            "x-ogc-propertySeq" : 6,
            "x-ogc-unit": "m/s",
            "x-ogc-definition": "https://qudt.org/vocab/quantitykind/Speed"
         },
         ...
      }
   },
   "dimensions" : [ {
      "name": "time",
      "interval" : [ "2022-10-06", "2022-10-10" ],
      "grid" : { "cellsCount" : 5, "resolution" : "P1D" }
   } ],
   "values" : {
      "pr" : [ {
         "depth" : 8,
         "shape" : { "count" : 33215, "subZones" : 6643, "dimensions" : { "time" : 5 } },
         "data" : [
            0.0003729638805, 0.0004226717055, 0.0007104640621, 0.0008059472461, 0.0000912571239,
            0.0005371499461, 0.0005135724622, 0.0008003884381, 0.0007072870373, 0.0000603493833,
            ...,
            0.0000608985125, 0.0000827684982, 0.0000371927567, 0.0000246966925, 0.0000095615553
         ]
      } ],
      "sfcWind" : [ {
         "depth" : 8,
         "shape" : { "count" : 33215, "subZones" : 6643, "dimensions" : { "time" : 5 } },
         "data" : [
            5.1973060025736, 7.541365875696, 10.7034694149118, 13.1711771530757, 9.8653782764459,
            6.7253713877706, 7.922387440188, 10.7766137018728, 12.3413589506021, 9.2283374128277,
            ...,
            2.4033131921971, 2.5349241545049, 2.4223932801007, 2.3289998661706, 2.7221016029128
         ]
      } ],
      ...
----

The following example requests a single day, October 9, 2022, from the same dataset.

https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/ISEA3H/zones/A1-0-E/data?zone-depth=8&datetime=2022-10-09&f=json[\https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/ISEA3H/zones/A1-0-E/data?zone-depth=8&datetime=2022-10-09]

The DGGS-JSON extract from the response for this single slice of time does not include an additional time dimension.

[%unnumbered%]
[source,json]
----
{
   "dggrs" : "[ogc-dggrs:ISEA3H]",
   "zoneId" : "A1-0-E",
   "depths" : [ 8 ],
   "values" : {
      "pr" : [ {
         "depth" : 8,
         "shape" : { "count" : 6643, "subZones" : 6643 },
         "data" : [ 0.0008059472461, 0.0007072870373, ..., 0.0000246966925 ]
      } ],
      "sfcWind" : [ {
         "depth" : 8,
         "shape" : { "count" : 6643, "subZones" : 6643 },
         "data" : [ 13.1711771530757, 12.3413589506021, ..., 2.3289998661706 ]
      } ],
      ...
----

[#img_pr-time='{figure-caption} {counter:figure-num}']
.Visualization of precipitations from 2022-10-06 to 2022-10-10 for ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/ISEA3H/zones/A1-0-E[A1-0-E] from https://cds.climate.copernicus.eu/cdsapp#!/dataset/projections-cmip5-daily-single-levels[Copernicus Climate Data Store CMIP5 daily data on single levels]
image::images/pr-time.png[width=700,align="center"]

[#img_wind-time='{figure-caption} {counter:figure-num}']
.Visualization of wind speed from 2022-10-06 to 2022-10-10 for ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/ISEA3H/zones/A1-0-E[A1-0-E] from https://cds.climate.copernicus.eu/cdsapp#!/dataset/projections-cmip5-daily-single-levels[Copernicus Climate Data Store CMIP5 daily data on single levels]
image::images/wind-time.png[width=700,align="center"]

////
https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/ISEA3H/zones?parent-zone=A1-0-E&zone-level=9&f=geojson&compact-zones=false&&crs=[OGC:1534]&datetime=2022-10-06
https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/ISEA3H/zones?parent-zone=A1-0-E&zone-level=9&f=geojson&compact-zones=false&&crs=[OGC:1534]&datetime=2022-10-07
https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/ISEA3H/zones?parent-zone=A1-0-E&zone-level=9&f=geojson&compact-zones=false&&crs=[OGC:1534]&datetime=2022-10-08
https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/ISEA3H/zones?parent-zone=A1-0-E&zone-level=9&f=geojson&compact-zones=false&&crs=[OGC:1534]&datetime=2022-10-09
https://maps.gnosis.earth/ogcapi/collections/climate:cmip5:singlePressure/dggs/ISEA3H/zones?parent-zone=A1-0-E&zone-level=9&f=geojson&compact-zones=false&&crs=[OGC:1534]&datetime=2022-10-10
////

TIP: Temporal subsetting for a slice can also be achieved using the equivalent `subset=time("2022-10-06":"2022-10-10")` syntax for trimming, and `subset=time("2022-10-06")` for slicing.

==== Subsetting arbitrary dimensions

In addition to spatial and temporal dimensions, datasets may be comprised of additional dimensions, such as atmospheric pressure.
These dimensions can also be subset in a similar manner using the `subset` query parameter.

The following request is for relative humidity from an ERA5 dataset at 11:00 PM on April 6th, 2023 at pressure levels between 750 hPa and 900 hPa (inclusively).

https://maps.gnosis.earth/ogcapi/collections/climate:era5:relativeHumidity/dggs/ISEA3H/zones/A4-0-A/data?zone-depth=8&datetime=2023-04-06T23:00:00&subset=pressure(750:900)&f=json[\https://maps.gnosis.earth/ogcapi/collections/climate:era5:relativeHumidity/dggs/ISEA3H/zones/A4-0-A/data?zone-depth=8&datetime=2023-04-06T23:00:00&subset=pressure(750:900)]

The partial DGGS-JSON response below contains an additional `pressure` dimension, with 7 of the 37 pressure levels available from the collection.

[%unnumbered%]
[source,json]
----
{
   "dggrs" : "[ogc-dggrs:ISEA3H]",
   "zoneId" : "A4-0-A",
   "depths" : [ 8 ],
   "schema":
   {
      "$schema" : "https://json-schema.org/draft/2020-12/schema",
      "$id" : "https://maps.gnosis.earth/ogcapi/collections/climate:era5:relativeHumidity/schema",
      "title" : "ERA5 Relative humidity",
      "type": "object",
      "properties":
      {
         "r": {
            "type": "number",
            "title": "Relative humidity",
            "description": "Water vapour pressure as a percentage of the value at which the air becomes saturated",
            "x-ogc-propertySeq" : 1,
            "x-ogc-unit": "%",
            "x-ogc-definition": "https://qudt.org/vocab/quantitykind/RelativeHumidity"
         }
      }
   },
   "dimensions" : [ {
      "name": "pressure",
      "title": "Atmospheric pressure",
      "x-ogc-unit": "hPa",
      "x-ogc-definition": "https://qudt.org/vocab/quantitykind/AtmosphericPressure"
      "interval" : [ 750, 900 ],
      "grid" : { "cellsCount" : 7, "coordinates" : [ 750, 775, 800, 825, 850, 875, 900 ] }
   } ],
   "values" : {
      "r" : [ {
         "depth" : 8,
         "shape" : { "count" : 38752, "subZones" : 5536, "dimensions" : { "pressure" : 7 } },
         "data" : [
            83.0640563964844, 84.7935791015625, 89.8955307006836, 94.8348999023438, 96.1357727050781, 92.2027587890625, 88.4226226806641,
            50.4869918823242, 62.970329284668, 71.4487152099609, 77.9791564941406, 79.6762161254883, 82.0418395996094, 84.0924987792969,
            ...,
            10.35546875, 6.8243680000305, 11.2714557647705, 28.403600692749, 73.5849151611328, 87.5920486450195, 86.5950088500977
         ]
      } ]
   }
}
----

The following request is for the 900 hPa slice only. The corresponding DGGS-JSON response below does not include a pressure dimension.

https://maps.gnosis.earth/ogcapi/collections/climate:era5:relativeHumidity/dggs/ISEA3H/zones/A4-0-A/data?zone-depth=8&datetime=2023-04-06T23:00:00&subset=pressure(900)&f=json[\https://maps.gnosis.earth/ogcapi/collections/climate:era5:relativeHumidity/dggs/ISEA3H/zones/A4-0-A/data?zone-depth=8&datetime=2023-04-06T23:00:00&subset=pressure(900)]

[%unnumbered%]
[source,json]
----
{
   "dggrs" : "[ogc-dggrs:ISEA3H]",
   "zoneId" : "A4-0-A",
   "depths" : [ 8 ],
   "values" : {
      "r" : [ {
         "depth" : 8,
         "shape" : { "count" : 5536, "subZones" : 5536 },
         "data" : [ 88.4226226806641, 84.0924987792969, ..., 86.5950088500977 ]
      } ]
   }
}
----

[#img_rh-pressure='{figure-caption} {counter:figure-num}']
.Visualization of relative humidity for ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/climate:era5:relativeHumidity/dggs/ISEA3H/zones/A4-0-A[A4-0-A] from https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-pressure-levels[ERA5 hourly data on pressure levels from 1940 to present from Copernicus Climate Data Store]
image::images/rh-pressure.png[width=700,align="center"]
<<<

==== Field selection

Some data has multiple properties for a feature, or fields for a given cell or position, such as the precipitation and windspeed variables in the CMIP5 dataset illustrated above.
It is possible to retrieve only some of these available fields using the `properties` query parameter.
The following request retrieves only the red (`B04`), green (`B03`) and blue (`B02`) bands from a sentinel-2 dataset for ISEA3H zone G7-67252-D at a relative depth of 8.

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=8&datetime=2022-10-28&properties=B04,B03,B02&f=json["https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=8&datetime=2022-10-28&properties=B04,B03,B02"]

The following is a partial DGGS-JSON response for this previous request.
This collection has twelve other fields available (which are not returned by default, in this case).

[%unnumbered%]
[source,json]
----
{
   "dggrs" : "[ogc-dggrs:ISEA3H]",
   "zoneId" : "G7-67252-D",
   "depths" : [ 8 ],
   "values" : {
      "B02" : [ {
         "depth" : 8,
         "shape" : { "count" : 6643, "subZones" : 6643 },
         "data" : [ 655.101806640625, 744.5323486328125, ..., 2609.4609375 ]
      } ],
      "B03" : [ {
         "depth" : 8,
         "shape" : { "count" : 6643, "subZones" : 6643 },
         "data" : [ 511.2943725585938, 653.875732421875, ..., 2645.6328125 ]
      } ],
      "B04" : [ {
         "depth" : 8,
         "shape" : { "count" : 6643, "subZones" : 6643 },
         "data" : [ 223.4036102294922, 236.1580047607422, ..., 2563.61083984375 ]
      } ]
   }
}
----

[#img_field-selection-rgb='{figure-caption} {counter:figure-num}']
.Visualization of different B04 (red), B03 (green) and B02 (blue) bands for ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D[G7-67252-D] (K'gari, Australia) from https://sentinel.esa.int/web/sentinel/missions/sentinel-2[Copernicus SENTINEL-2 operated by ESA]
image::images/field-selection-rgb.png[width=700,align="center"]

<<<

[keep-with-next=true]
The following request retrieves only the Scene Classification Layer (`SCL`) for the same zone. This field has a lower resolution than the other bands, and could be returned at a lower depth than the other fields if requesting multiple fields at a `zone-depth` beyond the resolution of the SCL field.

[keep-with-next=true]
https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=8&datetime=2022-10-28&properties=SCL&f=json[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=8&datetime=2022-10-28&properties=SCL]

[#img_field-selection-scl='{figure-caption} {counter:figure-num}']
.Visualization of SCL (Scene Classification Layer) field for ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D[G7-67252-D] (K'gari, Australia) from https://sentinel.esa.int/web/sentinel/missions/sentinel-2[Copernicus SENTINEL-2 operated by ESA]
image::images/field-selection-scl.png[width=700,align="center"]

[keep-with-next=true]
The following request retrieves only the near-infrared (`B08`) band for the same zone.

[keep-with-next=true]
https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=8&datetime=2022-10-28&properties=B08&f=json[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=8&datetime=2022-10-28&properties=B08]

[#img_field-selection-b08='{figure-caption} {counter:figure-num}']
.Visualization of B08 (near-infrared) band for ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D[G7-67252-D] (K'gari, Australia) from https://sentinel.esa.int/web/sentinel/missions/sentinel-2[Copernicus SENTINEL-2 operated by ESA]
image::images/field-selection-b08.png[width=700,align="center"]

TIP: Although the examples illustrated here are all for rasterized data, field selection can also be applied to feature collection outputs so select which properties to include.

==== Filtering zone data using CQL2 expressions

The `filter` query parameter can be used to only include data matching a CQL2 expression, which can reference the queryables of the collections, such as the feature properties or fields.

In a DGGS-JSON output, sub-zones which are not a match get replaced by a `null` value. In a GeoTIFF output, pixel values get replaced by a NODATA value.

Although the examples illustrated here are all for rasterized data, a CQL2 expression filter can also be applied to feature collections to select which feature to include in the output.

[keep-with-next=true]
The following request retrieves bathymetry data for ISEA3H zone A8-0-F at a relative depth of 8 without a filter.

[keep-with-next=true]
https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A8-0-F/data?zone-depth=8&f=json[\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A8-0-F/data?zone-depth=8]

[#img_filter-bathymetry-nofilter='{figure-caption} {counter:figure-num}']
.Visualization of ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A8-0-F[A8-0-F] from https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] without a filter
image::images/filter-bathymetry-nofilter.png[width=700,align="center"]

[keep-with-next=true]
The following request retrieves bathymetry data for the same zone with a filter for sea depths greater than 4000 meters.

[keep-with-next=true]
https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A8-0-F/data?zone-depth=8&filter=Elevation<-4000&f=json["https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A8-0-F/data?zone-depth=8&filter=Elevation < -4000"]

[#img_filter-bathymetry-4000='{figure-caption} {counter:figure-num}']
.Filtering of ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones/A8-0-F[A8-0-F] from https://www.gebco.net/news_and_media/gebco_2014_grid.html[GEBCO 2014 bathymetry] for depths 4000 meters below sea level
image::images/filter-bathymetry-4000.png[width=700,align="center"]

<<<

[keep-with-next=true]
When retrieving a temporal slice with a filter, the server may fill in the filtered out sub-zones with earlier imagery not excluded by the filter.
This can be used for example to replace cloudy sub-zones with the closest earlier cloud-free imagery.
The following requests retrieve sentinel-2 data for zone G7-67252-D between August 1, 2022 and August 31, 2022 at a relative depth of 12 with:

_no filter:_

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&crs=OGC:1534&datetime=2022-08-01/2022-08-31[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&datetime=2022-08-01/2022-08-31]

_filtering only high probability clouds (SCL: 9):_

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&crs=OGC:1534&datetime=2022-08-01/2022-08-31&filter=SCL<>9[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&datetime=2022-08-01/2022-08-31&filter=SCL <> 9]

_also filtering out medium probability clouds (SCL: 8):_

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&crs=OGC:1534&datetime=2022-08-01/2022-08-31&filter=SCL<>8%20and%20SCL<>9[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&datetime=2022-08-01/2022-08-31&filter=SCL <> 8 and SCL <> 9]

_also filtering out cirrus clouds (SCL: 10):_

https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&crs=OGC:1534&datetime=2022-08-01/2022-08-31&filter=SCL%20not%20in%20(8,9,10)["https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D/data?zone-depth=12&datetime=2022-08-01/2022-08-31&filter=SCL not in (8, 9, 10)"]

[#img_filter-sentinel2-kgari='{figure-caption} {counter:figure-num}']
.Filtering out high probability clouds, medium probability clouds, and cirrus clouds for ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G7-67252-D[G7-67252-D] (K'gari, Australia) from https://sentinel.esa.int/web/sentinel/missions/sentinel-2[Copernicus SENTINEL-2 operated by ESA]
image::images/filter-sentinel2-kgari.png[width=700,align="center"]

[keep-with-next=true]
The following request specifies a more complex filter using CQL2 arithmetic expressions to filter for a normalized difference vegetation index (NDVI) greater than 0.3, computed using the near-infrared (`B08`) and red bands (`B04`) using the expression `(B08-B04)/(B08+B04)`:

// NDVI filter

[keep-with-next=true]
https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G6-E046-D/data?zone-depth=9&filter=(B08-B04)/(B08+B04)%20%3E%200.3&f=json[\https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G6-E046-D/data?zone-depth=9&filter=(B08-B04)/(B08+B04)>0.3]

[#img_filter-sentinel2-ndvi='{figure-caption} {counter:figure-num}']
.Filtering based on a minimum normalized difference vegetation index (NDVI) for ISEA3H zone https://maps.gnosis.earth/ogcapi/collections/sentinel2-l2a/dggs/ISEA3H/zones/G6-E046-D[G6-E046-D] from https://sentinel.esa.int/web/sentinel/missions/sentinel-2[Copernicus SENTINEL-2 operated by ESA]
image::images/filter-sentinel2-ndvi.png[width=700,align="center"]
